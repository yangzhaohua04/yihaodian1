"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function formatTime(e){return e<10?"0"+e:e}function Translator(e){e="string"==typeof e?$(e):e,e.css("position","relative");var t=$('<div class="translate-err-tip">翻译查询失败，请稍后再试</div>');e.append(t),this.errTip=t}function isHuaWeiWeChat(){var e=window.navigator.userAgent||"",t=/HUAWEI/i.test(e)||/HONO/i.test(e),n=/micromessenger/.test(e.toLowerCase());return!(!t||!n)}function timeReturn(e){return e<10&&e>=0?e="0"+e:e<0&&Math.abs(e)<10?e="-0"+Math.abs(e):e}function InteractiveApp(e){this.options=e,this.socket=e.socket,this.shouldInitAnswer=e.shouldInitAnswer,this.userInfo=e.userInfo,this.channelInfo=e.channelInfo,this.locale=e.locale,this.interactiveSDK=null}Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var a=arguments[1],i=0;i<n;){var o=t[i];if(e.call(a,o,i,t))return i;i++}return-1}});var $=window.jQuery;$(document).ready(function(){function e(e){if(e&&"Y"!==$(e).data("reseted")){var t=$(e).data("src");e.src="",e.src=t,$(e).data("reseted","Y")}}$.fn.scrollUnique=function(){return $(this).each(function(){var e="mousewheel";void 0!==document.mozHidden&&(e="DOMMouseScroll"),$(this).on(e,function(e){var t=this.scrollTop,n=this.scrollHeight,a=this.clientHeight,i=e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-(e.originalEvent.detail||0);(i>0&&t<=i||i<0&&n-a-t<=-1*i)&&(this.scrollTop=i>0?0:n,e.preventDefault())})})},$("#talk,.user-main,#facemain").scrollUnique(),$("body").on("click",function(e){$(e.target).hasClass("icon-emotion")||($(".talk-ipt").hasClass("show-face")&&($(".talk-ipt").removeClass("show-face"),$(".icon-emotion").removeClass("icon-active")),$(this).hasClass("face-layer-show")&&$(this).removeClass("face-layer-show"))}),function(){var e=$(".bbox-tab-nav>li"),t=e.length;e.css("width",100/t+"%"),e.eq(0).addClass("active"),$(".bbox-tab-panel>li").eq(0).addClass("active"),e.each(function(e){$(this).data("tab",e)})}(),function(){var e,t=window.ClipboardJS,n=$(".btn-copy-addr");t&&new t(".btn-copy-addr",{text:function(){return $(".addr-ipt").val()}}).on("success",function(){n.html(window.customTemplate?"Copy success!":window.i18nText.copySuccess),clearTimeout(e),e=setTimeout(function(){n.html(window.i18nText.copy)},2e3)})}(),$("#mboxTab").on("click","li",function(){var e=$(this);$("#mboxTab").children(".active").removeClass("active"),e.addClass("active"),$("#mboxPanelsWrap").children(".active").removeClass("active"),$(e.data("target")).addClass("active")}),$(".talk-icon").click(function(){var e=$(this);if(!e.hasClass("icon-flower")){var t=$(".icon-active").data("target"),n=$(this).data("target");e.hasClass("icon-active")?(e.removeClass("icon-active"),$(".talk-ipt").removeClass(n)):($(".icon-active").removeClass("icon-active"),e.addClass("icon-active"),t&&$(".talk-ipt").removeClass(t),$(".talk-ipt").addClass(n))}}),$("body").on("click",".modal-mask",function(){$(".reward-modal-close,#close-redpaper").trigger("click"),$(".talk-ipt").hasClass("show-face")&&$(".talk-ipt").removeClass("show-face"),$(".modal-mask").remove()});var t=$(".bbox-tab-nav>li")&&$(".bbox-tab-nav>li")[0],n=$(".bbox-tab-panel>li").eq(0).find("iframe");n=n&&n[0],"iframe"===$(t).data("type")&&e(n),$(".bbox-tab-nav>li").on("click",function(){var t=$(this).data("tab");$(".bbox-tab-nav>li.active,.bbox-tab-panel>li.active").removeClass("active"),$(this).addClass("active"),$(".bbox-tab-panel>li").eq(t).addClass("active");var n=$(this).data("type"),a=$(".bbox-tab-panel>li").eq(t).find("iframe");a=a&&a[0],"iframe"===n&&e(a)}),$("#totalamount").on("keyup",function(e){var t=$(this).val(),n=t.length,a=0;if(e.key.match(/^[0-9.]*$/g))if(0==e.key&&1==n)alert("金额不能小于1元"),$(this).val("");else if(t>300)alert("金额不能超过300元");else{if("."==e.key&&"."==t[n-2])$(this).val(t.slice(0,n-1));else if(-1!=t.indexOf(".")){var i=t.split(".");a=i[1].length>0&&i[1].length<2?1:2,i[1].length>2&&$(this).val(t.slice(0,n-1))}else a=0;0==a?$(".money-text").text($(this).val()+".00"):1==a?$(".money-text").text($(this).val()+"0"):$(".money-text").text($(this).val())}else if(8!=e.keyCode&&$(this).val(t.slice(0,n-1)),t)if(-1==t.indexOf("."))$(".money-text").text($(this).val()+".00");else{var i=t.split(".");0==i[1].length&&$(".money-text").text($(this).val()+"00"),1==i[1].length&&$(".money-text").text($(this).val()+"0"),2==i[1].length&&$(".money-text").text($(this).val())}else $(".money-text").text("0.00")}),$("#number").on("keyup",function(e){var t=$(this).val(),n=t.length;e.key.match(/^[0-9]*$/g)?0==e.key&&1==n?(alert("红包个数不能小于1个"),$(this).val("")):t.match(/^([1-9]|1[0-9]|20)$/g)||alert("红包个数不能超过20个"):$(this).val(t.slice(0,n-1))}),$(".btn-redpaper").on("click",function(){var e=$("#totalamount").val(),t=$("#number").val();return e.match(/^(([1-9]|[1-9]\d|[1-2]\d{2})(\.\d{1,2})?|300)$/g)?t.match(/^([1-9]|1[0-9]|20)$/g)?void 0:(alert("请输入合法的红包个数"),$("#number").focus(),!1):(alert("请输入合法的数字,如1.88"),$("#totalamount").focus(),!1)}),$(".cash-list").on("click","li",function(){var e=$(this);$(".diy-cash-input-pc").val(""),$(".selected").removeClass("selected"),e.addClass("selected"),$("#amount").val(e.data("price"))}),$(".diy-cash-input-pc").on("keydown",function(){$(".cash-list>li.selected").removeClass("selected")}),$("#js-connect-mp-toggle-arrow").click(function(){$(this).toggleClass("connect-mp-toggle-arrow-down connect-mp-toggle-arrow-up"),"up"==$(this).data("status")?($(".mbox-rwrp").removeClass("main-right-container-toggle"),$(".connect-mp-bd").slideDown(),$(this).data("status","down")):($(".connect-mp-bd").slideUp(function(){$(".mbox-rwrp").addClass("main-right-container-toggle")}),$(this).data("status","up"))})});var _variable={MAJORVERSION:10,MAJORREVISION:3,FLASH:"FLASH",HTML:"HTML",INSTALLER:"INSTALLER",NO_SUPPORT:"NO_SUPPORT",LOADING:"LOADING",WAITING:"WAITING",PLAYING:"PLAYING",PAUSE:"PAUSE",ERROR:"ERROR",ENDED:"ENDED"},ua=function(e){var t=navigator.userAgent;return{isIE:function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},checkFlashSupportIE:function(){var e;try{e=/ ([0-9]+),([0-9]+),([0-9]+),/.exec(new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7").GetVariable("$version"))}catch(e){return null}return{majorVersion:e[1],majorRevision:e[2],minorRevision:e[3]}},checkFlashSupportStandard:function(){var e,t,n,a;try{if(!(void 0!==navigator.plugins&&navigator.plugins.length>0))return null;if(!navigator.plugins["Shockwave Flash 2.0"]&&!navigator.plugins["Shockwave Flash"])throw new Error;var i=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",o=navigator.plugins["Shockwave Flash"+i].description,s=navigator.plugins["Shockwave Flash"+i].filename;if(s.match&&s.toLowerCase().match(/lite/))throw new Error;e=o.split(" "),t=e[2].split(".")[0],n=e[2].split(".")[1],a=e[3],""==a&&(a=e[4]),"d"==a[0]?a=a.substring(1):"r"==a[0]&&(a=a.substring(1),a.indexOf("d")>0&&(a=a.substring(0,a.indexOf("d"))))}catch(e){return null}return{majorVersion:t,majorRevision:n,minorRevision:a}},checkFlashSupport:function(){return this.isIE()?this.checkFlashSupportIE():this.checkFlashSupportStandard()},checkHtmlSupport:function(){var e=document.createElement("video"),n=!0;t.match(new RegExp("android","i"))||(n=!(!e.canPlayType||!e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,"")));var a=!!document.createElement("canvas").getContext;return n&&a},isSupportedHTMLDevice:function(){for(var e=["iPad","iPhone","iPod","android"],n=e.length,a=0;a<n;a++)if(t.match(new RegExp(e[a],"i")))return!0;return!1},isFlashVersionSufficient:function(e){return null!=e&&(e.majorVersion>_variable.MAJORVERSION||e.majorVersion==_variable.MAJORVERSION&&e.majorRevision>_variable.MAJORREVISION)},determinePlayerType:function(){var t=this.checkFlashSupport(),n=this.checkHtmlSupport();return e.forceHTML5?_variable.HTML:e.forceFlash?_variable.FLASH:null==t&&0==n?_variable.NO_SUPPORT:this.isSupportedHTMLDevice()&&n?_variable.HTML:null!=t?this.isFlashVersionSufficient(t)?_variable.FLASH:_variable.INSTALLER:n?_variable.HTML:_variable.NO_SUPPORT}}},checkFlash=new ua,checkFlashSupport=checkFlash.checkFlashSupport(),htmlSupport=checkFlash.checkHtmlSupport(),isIE=checkFlash.isIE(),flashSupport=!0;(!checkFlashSupport||checkFlashSupport.majorVersion<10||10===checkFlashSupport.majorVersion&&checkFlashSupport.majorRevision<3)&&(flashSupport=!1);var $=window.jQuery;$(document).ready(function(){function e(){$(".player-main").empty(),playerOptions.forceH5=!0,player=polyvLivePlayer(playerOptions),callInteraction&&callInteraction.setPlayer(player)}var t=$(".money-text"),n=$("#totalamount"),a=$(".player-switch"),i=$(".player-content"),o=$(".player-layer"),s=$(".not-install-flash"),d=$(".html-content"),r=$(".switch-player-content"),u=null;!function(){"flash"!==playerType||flashSupport||"vod"===playbackOrigin||(s.show(),htmlSupport&&!isIE||(d.hide(),r.hide()))}();navigator.userAgent.toLowerCase().match(/MicroMessenger/i);var c=a.find(".switch-icon");"html"===playerType&&c.is(".html-player")&&(c.removeClass("html-player").addClass("flash-player"),i.text(i18nText.switchFlash)),"flash"===playerType&&c.is(".flash-player")&&(c.removeClass("flash-player").addClass("html-player"),i.text(i18nText.switchHtml)),o.on("mousemove",function(){"Y"!==switchPlayerEnabled||isIE||"vod"===playbackOrigin||(a.fadeIn(),clearTimeout(u),u=setTimeout(function(){a.fadeOut()},3e3))}),a.on("click",function(){var t=$(this).find(".switch-icon"),n=t.is(".flash-player");if(a.hide(),n){if(!flashSupport)return void s.show();t.removeClass("flash-player").addClass("html-player"),player.destroy(),playerOptions.forceH5=!1,player=polyvObject(".player-main").livePlayer(playerOptions),i.text(i18nText.switchHtml),callInteraction&&callInteraction.setPlayer(player),window.localStorage.playerType="flash"}else t.removeClass("html-player").addClass("flash-player"),e(),i.text(i18nText.switchFlash),window.localStorage.playerType="html"}),window.enablePointDonate&&function(){$.ajax({url:"/point/get?channelId="+channelId,type:"GET",dataType:"json"}).done(function(e){0===e.code&&$(".myPoint").html(e.data)})}(),$("#back").on("click",function(){$(".wrap").toggleClass("toggle")}),$("body").on("click","#close-btn",function(){$("#wxpay-box").hide(),$(".my-mask").hide(),clearInterval(timer),timer=null});var l=$("#image-text-carousel");l.owlCarousel({autoplay:!0,loop:!0,items:1,dots:!1,nav:!0,navText:["&lt;","&gt;"],navContainer:"#image-text-carousel-nav",mouseDrag:!1}),$("#close-image-text-carousel").on("click",function(){return l.remove(),$(this).remove(),!1}),n.on("keyup",function(e){var n=$(this),a=n.val(),i=a.length,o=0;if(e.key.match(/^[0-9.]*$/g)){if(0==e.key&&1==i)return alert(i18nText.rpSumMoreThan1),n.val(""),!1;if(a>300)return alert(i18nText.rpSumLessThan300),!1;if("."==e.key&&"."==a[i-2])n.val(a.slice(0,i-1));else if(-1!=a.indexOf(".")){var s=a.split(".");o=s[1].length,o>2&&n.val(a.slice(0,i-1))}a=n.val(),0==o?t.text(a+".00"):1==o?t.text(a+"0"):t.text(a)}else if(8!=e.keyCode&&n.val(a.slice(0,i-1)),a=n.val())if(-1==a.indexOf("."))t.text(a+".00");else{var s=a.split(".")[1];0==s.length&&t.text(a+"00"),1==s.length&&t.text(a+"0"),2==s.length&&t.text(a)}else t.text("0.00")}),$("#number").on("keyup",function(e){var t=$(this).val(),n=t.length;e.key.match(/^[0-9]*$/g)?0==e.key&&1==n?(alert(i18nText.rpNumberMoreThan1),$(this).val("")):t.match(/^([1-9]|1[0-9]|20)$/g)||alert(i18nText.rpNumberMoreThan20):$(this).val(t.slice(0,n-1))}),$(".btn-redpaper").on("click",function(){var e=n.val(),t=$("#number").val();return e.match(/^(([1-9]|[1-9]\d|[1-2]\d{2})(\.\d{1,2})?|300)$/g)?t.match(/^([1-9]|1[0-9]|20)$/g)?void 0:(alert(i18nText.rpNumberEligible),$("#number").focus(),!1):(alert(i18nText.rpSumEligible),n.focus(),!1)}),$(".reward-gifts-list-arrow").on("click","span",function(){"next"===$(this).data("type")?$(".gifts-list").addClass("reward-gifts-list-next"):$(".gifts-list").removeClass("reward-gifts-list-next")});var p=!1,f=22.5-$("#mboxContent").offset().left;$(window).resize(function(){f=22.5-$("#mboxContent").offset().left}),$("#giftsList").on("mouseenter","li",function(){if("block"==$("#wxpay-box").css("display"))return!1;$("#rewardCashModal").hide(),$(".js-good-number-select-list span").eq(0).trigger("click");var e=$(this),t=e.offset().left+f-100,n=$("#form-gifts"),a=e.data("goodid"),i=e.data("goodprice"),o=e.data("goodname"),s=e.data("goodpic"),d=window.enablePointDonate?i+" 点":"￥ "+i;return n.find('input[name="good_id"]').val(a),$("#giftName").html(o),$("#giftPic").attr("src",s),$("#giftPrice").html("0.00"===i?i18nText.goodFree:d),$("#rewardGiftModal").css("left",t).show(),!1}).on("mouseleave",function(){setTimeout(function(){p||$("#rewardGiftModal").hide()},150)}).on("click","li",function(){return!1}),$("#rewardCashWrap").on("mouseenter",function(){if("block"==$("#wxpay-box").css("display"))return!1;$("#rewardGiftModal").hide();var e=$(this),t=e.offset().left+f-150;return $("#rewardCashModal").css("left",t).show(),!1}).on("mouseleave",function(){setTimeout(function(){p||$("#rewardCashModal").hide()},100)}).on("click","li",function(){return!1}),$(".reward-modal").on("click",function(){return!1}).on("mouseenter",function(){p=!0}).on("mouseleave",function(){p=!1,$(this).hide()}),$("html").on("click",function(){$("#rewardGiftModal").hide(),$("#rewardCashModal").hide(),$(".plv-watch-qa-top-right").removeClass("show-category-selection")}),$(".polyv-modal-close").on("click",function(){var e=$(this).parents(".polyv-modal");return e.hasClass("redpaper-wrap")?($(".talk-ipt-pc").removeClass("show-redpaper"),$("#redpaper-wrap .polyv-form-control").val(""),$('input[name="redpapertext"]').val(i18nText.blessWord),$("#count-num").text(9),t.text("0.00")):e.hide(),e.hasClass("reward-cash-modal")&&($(".selected").removeClass("selected"),$("#customMoney").val(""),$("#cash_amount").val("")),reward_timer&&(clearInterval(reward_timer),reward_timer=null),!1}),$(".cash-list").on("click","li",function(){var e=$(this);$(".diy-cash-input-pc").val(e.data("price")),$(".selected").removeClass("selected"),e.addClass("selected"),$("#cash_amount").val(e.data("price"))}),$(".diy-cash-input-pc").on("keydown",function(){$(".cash-list>li.selected").removeClass("selected")})}),function(e){function t(e){this.config=e,this.el=e.el,this.layoutClass=e.layoutClass,this.isMobile=e.isMobile,this.socket=e.socket,this.id,this.delayTime=isMobile?8e3:2e3,"function"!=typeof this.config.startCallback&&(this.config.startCallback=function(){}),"function"!=typeof this.config.endCallback&&(this.config.endCallback=function(){}),"function"!=typeof this.config.successCallback&&(this.config.successCallback=function(){}),this.init()}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t},a=Math.pow(2,53)-1,i=function(e){var t=n(e);return Math.min(Math.max(t,0),a)};return function(e){var n=this,a=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!t(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var d,r=i(a.length),u=t(n)?Object(new n(r)):new Array(r),c=0;c<r;)d=a[c],u[c]=s?void 0===o?s(d,c):s.call(o,d,c):d,c+=1;return u.length=r,u}}()),Array.prototype.map||(Array.prototype.map=function(e,t){var n,a,i;if(null==this)throw new TypeError("this is null or not defined");var o=Object(this),s=o.length>>>0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError(e+"is not a function");for(t&&(n=t),a=new Array(s),i=0;i<s;){var d,r;i in o&&(d=o[i],r=e.call(n,d,i,o),a[i]=r),i++}return a}),Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var a=[],i=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)if(o in t){var s=t[o];e.call(i,s,o,t)&&a.push(s)}return a}),Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(e){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,n=Object(this),a=n.length>>>0,i=0;if(arguments.length>=2)t=arguments[1];else{for(;i<a&&!(i in n);)i++;if(i>=a)throw new TypeError("Reduce of empty array with no initial value");t=n[i++]}for(;i<a;)i in n&&(t=e(t,n[i],i,n)),i++;return t}});var a={parseString:function(e){return e&&"string"==typeof e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim():e},layout:function(e){var t=e.title||"";return'<div class="live-questionnaire '+(e.layoutClass||"")+'"><div class="live-questionnaire-head">'+this.parseString(t)+'<span data-type="close">×</span></div><div class="live-questionnaire-container"><div class="live-questionnaire-content js-questionnaireContent"></div></div>'+"</div>".trim()},option:function(e,t,a){return t=this.parseString(t),'<div class="live-questionnaire-option live-questionnaire-option-'+e+'" title="'+t+'" data-answer="'+n[a]+'"><span>'+n[a]+"."+t+"</span>"+"</div>".trim()},textarea:function(){return"<textarea></textarea>"},btn:function(){return'<div class="live-questionnaire-foot"><span data-type="submit">'+window.i18nText.questionnaireSubmit+"</span></div>"},question:function(e){var t,n=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("Q"===e.type)t=this.textarea();else{var i=[];e.options.forEach(function(e,t){t%2==0?i.push([e]):i[i.length-1].push(e)});var o=0;t=i.reduce(function(t,a){return t+'<div class="live-questionnaire-question-col">'+n.option(e.type,a[0],o++)+(a[1]?n.option(e.type,a[1],o++):"")+"</div>"},"")}return'<div class="live-questionnaire-question">'+(a?"":"<span>"+e.index+"</span>")+'<div class="live-questionnaire-question-head">'+(a?e.index+". ":"")+this.parseString(e.name)+"<sup>"+(e.required?"*":"")+"</sup>"+("C"===e.type?" <span>("+window.i18nText.questionnaireMultiple+")</span>":"")+'</div><div class="live-questionnaire-question-error js-questionnaireError"><span>'+window.i18nText.questionnaireRequired+'</span></div><div class="js-questionnaireOption">'+t+"</div>"+"</div>".trim()},tips:function(e){return'<div class="live-questionnaire-tips">'+e+"</div>"},msg:function(e){return'<div class="live-questionnaire-msg">'+e+"</div>"}};t.prototype={init:function(){if(!this.socket)return this;var e=this;e.socket.on("message",function(t){if((t=JSON.parse(t))&&t.EVENT)switch(t.EVENT){case"START_QUESTIONNAIRE":e.questionnaireData=t,e.renderContent();break;case"STOP_QUESTIONNAIRE":if(clearTimeout(e.contentClock),e.contentClock=null,!e.data)return;e.showTips(window.i18nText.questionnaireStop,"stop"),e.remove()}})},renderContent:function(){var e=this;clearTimeout(e.contentClock),e.contentClock=setTimeout(function(){clearTimeout(e.contentClock),e.contentClock=null,e.startQuestionNaire(e.questionnaireData)},e.delayTime)},singleHandler:function(e,t,n){n.answer!==t&&(n.currentEl&&n.currentEl.removeClass("checked"),n.required&&n.showError&&(n.showError=!1,n.tips.hide()),e.addClass("checked"),n.answer=t,n.currentEl=e)},multiHandler:function(e,t,n){n.answer||(n.answer={}),n.answer[t]?(e.removeClass("checked"),delete n.answer[t]):(e.addClass("checked"),n.answer[t]=!0),n.required&&n.showError&&Object.keys(n.answer).length>0&&(n.showError=!1,n.tips.hide())},askHandler:function(t,n){t.find("textarea").on("change",function(e){n.answer=e.target.value.trim(),n.required&&n.showError&&n.answer&&(n.showError=!1,n.tips.hide())}),t.find("textarea").on("input",function(a){n.answer=a.target.value.trim(),(!n.answer||n.answer.length<=500)&&e(t).find("textarea").removeClass("live-questionnaire-question-textarea-err")})},initOptionHandler:function(t){var n=this;"Q"===t.type?n.askHandler(t.el,t):t.el.on("click","[data-answer]",function(){var a=e(this),i=a.attr("data-answer");"R"===t.type?n.singleHandler(a,i,t):n.multiHandler(a,i,t)})},initBtnHandler:function(){var t=this;t.data.el.on("click","[data-type]",function(n){var i=e(n.target),o=i.attr("data-type"),s=t.data.el.find(t.isMobile?".live-questionnaire-container":".js-questionnaireContent");if("close"===o&&(t.remove(),t.config.endCallback()),"submit"===o){if(!t.data.allow)return;var d=[],r=!0,u=!1;if(t.data.questions.forEach(function(n){var i=n.answer;if("C"===n.type&&(i=i||{},i=Object.keys(i).sort().join("")),"Q"===n.type){if(i&&i.length>500)return t.showMsg(window.i18nText.questionnaireExceed),r=!1,void e(n.el).find("textarea").addClass("live-questionnaire-question-textarea-err");i=a.parseString(i)}n.required&&!i?(r=!1,n.tips.show(),n.showError=!0,u||(s.scrollTop(n.el[0].offsetTop-(t.isMobile?60:100)),u=!0)):d.push({questionId:n.id,answer:i})}),!r)return;t.sendQuestionnaireAnswer(t.data.id,d),t.config.successCallback(),t.showTips(window.i18nText.questionnaireSubmitSuccess),t.remove()}})},showTips:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",i=e(a.tips(t)).addClass("live-questionnaire-tips-"+n),o=this;o.el.append(i),setTimeout(function(){i.remove(),o.config.endCallback()},2e3)},showMsg:function(t){var n=e(a.msg(t));e(this.el).find(".live-questionnaire").append(n),setTimeout(function(){n.remove()},2e3)},remove:function(){this.data.el.remove(),this.data=void 0},render:function(){var t=e(a.layout(this.data)),n=t.find(".js-questionnaireContent"),i=this;this.data.questions.forEach(function(t){t.el=e(a.question(t,i.isMobile)),t.tips=t.el.find(".js-questionnaireError"),n.append(t.el),i.initOptionHandler(t)}),this.data.btn=e(a.btn()),n.append(this.data.btn),this.el.append(t),this.data.el=t,this.initBtnHandler()},formatQuestions:function(e){return e.map(function(e,t){return{required:"Y"===e.required,type:e.type,name:a.parseString(e.name),id:e.questionId,index:t+1,options:Array.from(new Array(10)).map(function(t,n){return e["option"+(n+1)]}).filter(function(e){return!!a.parseString(e)})}})},startQuestionNaire:function(e){if(this.data){if(this.data.id===e.content.questionnaireId)return;this.remove()}e.content&&e.content.questions&&(this.config.startCallback(),this.data={title:a.parseString(e.content.questionnaireTitle),id:e.content.questionnaireId,questions:this.formatQuestions(e.content.questions),layoutClass:this.layoutClass,allow:!0},this.render())},sendQuestionnaireAnswer:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=this.config,i={EVENT:"ANSWER_QUESTIONNAIRE",roomId:a.roomId,nick:a.nick,userId:a.userId,questionnaireId:e,answer:t};this.socket.emit("message",JSON.stringify(i),n)},updateDelayTime:function(e){"number"==typeof e&&e!==this.delayTime&&(this.delayTime=e,this.contentClock&&this.renderContent())}},window.Questionnaire=t}(jQuery);var $=window.jQuery,removeQuot=function(e){return e&&"string"==typeof e&&(e=e.replace(/"/g,"&quot;")),e},isMobile=!1,lotteryI18NText={en:{inputName:"name",inputNameTips:"Please enter your name",inputNameErrorTips:"Please enter your name",inputPhone:"phone",inputPhoneTips:"Please enter your mobile phone",inputPhoneErrorTips:"Wrong mobile phone",inputAddress:"address",get:"To get",got:"Geted",copyTip:"Copied to clipboard",addReceiveInfoFail:"Failed",inputNamaError:"Name cannot be filled with special character",inputAddressError:"The address cannot be filled with special characters"},zh_CN:{inputName:"姓名",inputNameTips:"请输入您的姓名",inputNameErrorTips:"请输入您的姓名",inputPhone:"电话",inputPhoneTips:"请输入您的电话",inputPhoneErrorTips:"号码错误",inputAddress:"地址",get:"领取",got:"已领取",copyTip:"兑换码已复制到剪贴板",addReceiveInfoFail:"网络不佳，稍后重试",inputNamaError:"姓名不可填写特殊字符",inputAddressError:"地址不可填写特殊字符"}},Lottery=function(e){this.el={$noticeListWrap:$("#noticeListWrap"),$noticeList:$("#noticeList"),$noticeIcon:$("#showNotice"),$moreIcon:$("#moreicon"),$inputList:$("#lotteryInputList"),$modalWrap:$(".plv-lottery-modal-wrap"),$winningModal:$(".lottery-winning"),$notWinModal:$(".lottery-notwin"),$successModal:$(".lottery-success"),$drawingModal:$(".lottery-drawing"),$confirmBtn:$("#submitWinnerInfo")},this.selector={$phone:"#lottery-phone",$name:"#lottery-name"},this.chatApiHost=e.chatApiHost,this.userId=e.userId,this.channelId=e.channelId,this.sessionId=e.sessionId,this.appendSystemInfo=e.appendSystemInfo,this.i18nText=e.i18nText,this.language=e.language||"zh_CN",isMobile=this.ismobile=e.ismobile,this.isChinese=e.isChinese,this.apiHost=e.apiHost,this.submitData={},this.listData={},this.curLotteryId="",this.isSaving=!1,this.isNoticeEventInit=!1};Lottery.activeIconCls="interactive-icon-item--active",Lottery.activeInputIconCls="talk-input-icon--active",Lottery.formatNoticeListData=function(e){if(!e||e.length<=0)return{};for(var t={},n=null,a=0;a<e.length;a++)n=e[a],t[n.lotteryId]=n;return t},Lottery.isEmoji=function(e){var t=["�[�-�]","�[�-�]","�[�-�]"];return!!e.match(t.join("|"))},Lottery.inputTemplate=function(e,t,n){var a=lotteryI18NText[n]||{},i=e.field,o={"姓名：":{name:"name",id:"lottery-name",label:a.inputName,tips:a.inputNameTips,errTips:a.inputNameErrorTips},"电话：":{name:"phone",id:"lottery-phone",label:a.inputPhone,tips:a.inputPhoneTips,errTips:a.inputPhoneErrorTips}}[i];o||(o={name:"field",label:i,tips:e.tips,errTips:"请输入"+i});var s,d=isMobile?"":"<label>"+o.label+"：</label>";if(t)s='<div class="input-wrap input-wrap--disabled"><input readonly value="'+e.value+'"></div>';else{var r=o.id?' id="'+o.id+'"':"";s='<div class="input-wrap">'+('<input type="text" name="'+o.name+'" placeholder="'+o.tips+'"'+r+' maxlength="500">')+('<span class="err-tip">'+o.errTips+"</span>")+"</div>"}return'<div class="input-col">'+d+s+"</div>"},Lottery.noticeTemplate=function(e,t){var n='<span class="notice-item__title" title="'+e.prize+'">'+e.prize+"</span>",a=lotteryI18NText[t].get,i=lotteryI18NText[t].got,o='<span class="notice-item__status">'+(e.received?i:a)+"</span>";return'<div class="notice-item '+(e.received?"notice-item--finished":"notice-item--notfinished")+'" data-id="'+e.lotteryId+'">'+n+o+"</div>"},Lottery.prototype={constructor:Lottery,updateSessionId:function(e){e!==this.sessionId&&(this.el.$noticeIcon.css("display","none"),this.renderNoticeList(null)),this.sessionId=e},fetchSessionId:function(e){var t=this;$.ajax({url:this.apiHost+"/live/channel-sessionid/query",data:{channelId:this.channelId}}).done(function(n){t.updateSessionId(n),"function"==typeof e&&e()}).fail(function(){console.log("sessionId获取失败")})},init:function(){this.tips=this.showTips(),this.bindLotteryEvent(),this.updateNoticeList()},showTips:function(){function e(){i&&(a&&a.remove(),clearTimeout(i),i=null)}function t(t,o){o=o||2e3,e(),a=$('<p class="lottery-tips">'+t+"</p>"),n.append(a),i=setTimeout(e,o)}var n=this.ismobile?this.el.$winningModal.find(".panel"):this.el.$winningModal,a=null,i=null;return t},updateNoticeList:function(e){var t=this;this.fetchLotteryList(function(n){if(n&&!(n.length<=0)){for(var a=!1,i=0;i<n.length;i++)if(!1===n[i].received){a=!0;break}t.el.$noticeIcon.css("display","inline-block").toggleClass(Lottery.activeIconCls,a),t.el.$moreIcon.toggleClass(Lottery.activeInputIconCls,a),t.renderNoticeList(n),t.bindNoticeEvent(),"function"==typeof e&&e()}})},fetchLotteryList:function(e){function t(e,t){$.ajax({url:t.chatApiHost+"/front/getLotteryRecordByUserId",data:{channelId:t.channelId,sessionId:t.sessionId,userId:t.userId,t:Date.now()}}).done(function(n){200===n.code?(t.listData=Lottery.formatNoticeListData(n.data),e(n.data)):console.log(n.message)}).fail(function(){console.log("抽奖数据获取失败。请刷新页面后重试。")})}var n=this;this.sessionId?t(e,n):this.fetchSessionId(function(){t(e,n)})},renderNoticeList:function(e){var t=this.el.$noticeList;if(!e||e.length<=0)return void t.empty();for(var n="",a=0;a<e.length;a++)n+=Lottery.noticeTemplate(e[a],this.language);t.html(n)},bindLotteryEvent:function(){var e=this.el.$confirmBtn,t=this,n="",a="",i=window.ClipboardJS;if(i){new i(".exchange-code",{text:function(){return $("#exchange-code").text()}}).on("success",function(e){t.tips(lotteryI18NText[t.language].copyTip),e.clearSelection()})}$(".lottery-modal").on("click",".js-lottery-close",this.hideAllLotteryModal.bind(this));var o=null;this.el.$modalWrap.on("focus","input",function(){clearTimeout(o),o=null}).on("blur","input",function(){o=setTimeout(function(){window.scrollTo(0,0),clearTimeout(o),o=null},100)}),this.el.$modalWrap.on("input",this.selector.$name,function(e){var a=$(e.target).val();if(a||n){t.checkName(a)&&(n=$(t.selector.$name).val())}}).on("blur",this.selector.$name,function(e){t.checkName($(e.target).val(),!0)}).on("focus",function(e){$(e.target).parents(".input-col").removeClass("error")}),this.el.$modalWrap.on("input",this.selector.$phone,function(e){var n=$(e.target).val();if(n||a){t.checkPhone(n)&&(a=$(t.selector.$phone).val())}}).on("blur",this.selector.$phone,function(e){t.checkPhone($(e.target).val(),!0)}).on("focus",this.selector.$phone,function(e){$(e.target).parents(".input-col").removeClass("error")}),e.on("click",function(){e.hasClass("lottery-close")||t.onSaveClick()}),$(".js-view-winners-list").on("click",function(){$(".js-lottery-return").data("target",$(this).data("target")),t.renderWinnersList(t.listData[t.curLotteryId].winnersList),t.el.$modalWrap.attr("data-modal","winners-list")}),$(".js-lottery-return").on("click",function(){t.el.$modalWrap.attr("data-modal",$(this).data("target"))}),$("#closeNoticeList").on("click",function(e){t.toggleNoticeList(e,!0)}),$("#fillInfo").on("click",function(){t.el.$modalWrap.attr("data-modal","fill-info")})},bindNoticeEvent:function(){if(!this.isNoticeEventInit){this.isNoticeEventInit=!0;var e=this.el.$noticeIcon,t=this.el.$noticeList,n=this;e.on("click",this.toggleNoticeList.bind(this)),t.on("click","[data-id]",this.onNoticeListClick.bind(this)),$("body").on("click",function(e){$(e.target).parents("#noticeList").length<=0&&n.toggleNoticeList(e,!0)})}},toggleNoticeList:function(e,t){return void 0!==t?this.el.$noticeListWrap.toggle(!t):this.el.$noticeListWrap.toggle(),!1},onNoticeListClick:function(e){this.toggleNoticeList(e,!0),this.showWinningModal($(e.currentTarget).attr("data-id"))},showWinningModal:function(e){if(e!==this.curLotteryId||this.listData[e].received){this.curLotteryId=e;var t=this.listData[this.curLotteryId];if(!t)return;if(t.collectInfo&&"string"==typeof t.collectInfo&&(t.collectInfo=JSON.parse(t.collectInfo)),this.renderInputList(t.collectInfo,t.received),t.sessionId!==this.sessionId)return;$("#exchange-code").text(t.winnerCode),$("#lottery-gift").html(t.prize),this.submitData={channelId:t.channelId,lotteryId:t.lotteryId,winnerCode:t.winnerCode},this.el.$confirmBtn.toggleClass("lottery-close",t.received)}this.el.$modalWrap.attr("data-modal","winning").show()},hideAllLotteryModal:function(){this.el.$modalWrap.attr("data-modal","").hide()},renderInputList:function(e,t){for(var n=this.el.$inputList,a="",i=0;i<e.length;i++)a+=Lottery.inputTemplate(e[i],t,this.language);n.html(a)},renderWinnersList:function(e){var t="";e.forEach(function(e,n){n%3==0&&(t+='<div class="lottery-winners-table-row">'),t+="<span>"+e.nick+"</span>",n%3==2&&(t+="</div>")}),$("#lotteryWinnersList").html(t.trim())},onSaveClick:function(){if(!this.isSaving){for(var e=this.listData[this.curLotteryId],t=e.collectInfo,n=this.el.$inputList.find("input[type=text]"),a=[],i="",o="",s=0;s<t.length;s++){if(i=t[s].field,o=n[s].value,"姓名"===i){if(!this.checkName(o,!0))return}else if("电话"===i&&!this.checkPhone(o,!0))return;a.push({field:removeQuot(i),value:removeQuot(o)})}var d={channelId:this.channelId,sessionId:this.sessionId,
lotteryId:this.curLotteryId,winnerCode:e.winnerCode,viewerId:this.userId,receiveInfo:JSON.stringify(a)};this.isSaving=!0;var r=this;$.ajax({url:this.chatApiHost+"/front/v2/add-receive-info",type:"POST",data:d}).done(function(e){r.isSaving=!1,200===e.code?(r.showSuccessModal(),r.updateNoticeList()):alert(r.isChinese?e.message:"Failed")}).fail(function(){r.isSaving=!1,alert(lotteryI18NText[r.language].addReceiveInfoFail)})}},showSuccessModal:function(){var e=this;this.el.$modalWrap.attr("data-modal","success"),setTimeout(function(){e.hideAllLotteryModal()},2e3)},lotteryStart:function(){this.appendSystemInfo(this.i18nText.lotteryInProgress),this.hideAllLotteryModal(),this.el.$modalWrap.attr("data-modal","drawing").show()},lotteryEnd:function(e){this.appendSystemInfo(this.i18nText.lotteryOver),this.hideAllLotteryModal();for(var t,n=0;n<e.data.length;n++){var a=e.data[n];if(a.userId===this.userId){t=a;break}}if(!t)return this.curLotteryId=e.lotteryId,this.el.$modalWrap.attr("data-modal","notwin").show(),void(this.listData[this.curLotteryId]={winnersList:e.winnersList});var i=this;this.updateNoticeList(function(){i.showWinningModal(e.lotteryId)})},onSocket:function(e,t){switch(e){case"LotteryStart":this.lotteryStart(t);break;case"LotteryEnd":this.lotteryEnd(t);break;case"ON_LOTTERY":this.lotteryStart(t)}},checkName:function(e,t){t=t||!1;var n=$(this.selector.$name);return e?t&&(e.length>10&&(e=e.slice(0,10),n.val(e)),Lottery.isEmoji(e))?(alert(lotteryI18NText[this.language].inputNamaError),!1):(n.parents(".input-col").removeClass("error"),!0):(n.parents(".input-col").addClass("error"),!1)},checkPhone:function(e,t){t=t||!1;var n=$(this.selector.$phone);e=e.replace(/[^0-9]/gi,"");return e.length>11&&(e=e.slice(0,11)),n.val(e),!e||t&&!/^1[3456789]\d{9}$/.test(e)?(n.parents(".input-col").addClass("error"),!1):(n.parents(".input-col").removeClass("error"),!0)},checkAddress:function(e,t){t=t||!1;var n=$(this.selector.$address);return e.length>500&&n.val(e.slice(0,500)),!t||!Lottery.isEmoji(e)||(alert(lotteryI18NText[this.language].inputAddressError),!1)}},window.Lottery=Lottery,function(){function e(e,t,a){var o=!e.gimg,d=e.unick,r=e.gimg||"//livestatic.videocc.net/assets/wimages/icon-redpaper.png",u=e.rewardContent,c=e.goodNum||1,l=!o&&c>1,p="";p=o?i.chatRewarded+" ¥"+u:i.chatPresented+" "+u;var f=document.createElement("div"),h="plv-reward-notice ";h+=s?"plv-reward-notice-ie9":"plv-reward-notice-animate-start",f.setAttribute("class",h),f.setAttribute("data-index",t);var m='<div class="plv-reward-notice-left"><p class="plv-reward-user-nick">'+d+'</p><p class="plv-reward-text-detail">'+p+'</p></div><div class="plv-reward-notice-middle"><img src="'+r+'"></div>';if(l&&(m+='<div class="plv-reward-notice-right"><span>x</span><span>'+c+"</span></div>"),f.innerHTML=m,n.appendChild(f),l)var v=setTimeout(function(){clearTimeout(v),v=null,s||f.classList.add("plv-reward-notice-number-animate")},150);var g=setTimeout(function(){clearTimeout(g),g=null,s||f.classList.add("plv-reward-notice-animate-end")},2150),w=setTimeout(function(){clearTimeout(w),w=null,f.parentNode.removeChild(f),"function"==typeof a&&a(t)},2200)}function t(n){var a=o.findIndex(function(e){return!0===e});if(-1!==a)o[a]=!1,e(n,a+1,function(e){o[e-1]=!0});else var i=setInterval(function(){-1!==o.findIndex(function(e){return!0===e})&&(t(n),clearInterval(i),i=null)},200)}"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var a=arguments[1],i=0;i<n;){var o=t[i];if(e.call(a,o,i,t))return i;i++}return-1}});var n=null,a=3,i={},o=[],s=-1!==navigator.userAgent.toLowerCase().indexOf("msie 9.0");window.PlvRewardAnimate=function(e){if(""!==e.container&&document.querySelector(e.container)){this.config={container:null,stayTime:2e3,maxShowNumber:3,lang:{chatRewarded:"打赏",chatPresented:"赠送"}},this.con,Object.assign(this.config,e),n=document.querySelector(this.config.container),i=this.config.lang,a=this.config.maxShowNumber;for(var t=0;t<a;t++)o.push(!0)}},window.PlvRewardAnimate.prototype.reward=function(e){"[object Object]"===Object.prototype.toString.call(e)&&t(e)}}();var $=window.jQuery,Lottery=window.Lottery,MD5=window.MD5,InteractiveApp=window.InteractiveApp;window.socket=null,console.info(20200326),window.testUsersCount={listCount:0,listLength:0,loginUser:0,logoutUser:0},location.origin||(location.origin=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")),$(document).ready(function(){function e(e,t,n){return $.ajax({url:e+"/front/historyBetween",data:{roomId:t.roomId,stime:t.stratTime,etime:t.endTime,size:t.size||10,page:t.page||1},type:"GET",dataType:"jsonp",async:void 0===n||n})}function t(e,t,n){return $.ajax({url:e+"/front/history",data:{roomId:t.roomId,start:t.start,end:t.start+10,toGetSubRooms:t.isTransmitChannel},type:"GET",dataType:"jsonp",async:void 0===n||n,timeout:3e3})}function n(e,t,n){var a=t.roomId,i=t.sessionId,o=t.page||1,s=(new Date).getTime(),d="polyvChatSign",r=d+"page"+o+"roomId"+a+"sessionId"+i+"size10timestamp"+s+d,u=MD5(r).toLocaleUpperCase();return console.log(r),$.ajax({url:e+"/front/getHistoryBySessionId",data:{roomId:a,sessionId:i,page:o,size:10,timestamp:s,sign:u},type:"GET",async:void 0===n||n})}function a(e){this.chatApiDomain=e.chatApiDomain,this.roomId=e.roomId,this.sessionId=e.sessionId,this.page=0,this.requestEnd=!0,this.hasMoreContent=!0}function i(e){var t=ze.children("li.msg");if(t.length>=qt){var n=t.eq(0);n.prev(".msg-time").length&&!n.next(".msg").length&&n.prev(".msg-time").remove(),n.remove()}ze.append('<li data-type="other-user-msg" class="msg sys-info">'+e+"</li>")}function o(){Ye.html(pt>1e4?(pt/1e4).toFixed(1)+"w":pt),$n=setInterval(function(){Ye.html(pt>1e4?(pt/1e4).toFixed(1)+"w":pt)},3e3)}function s(e){e&&e.css("z-index",ut)}function d(e){$.ajax({url:xt+"/front/getUserCount",type:"POST",data:{roomIds:"undefined"!=typeof sibRooms&&sibRooms.length?sibRooms.join(","):Lt}}).done(function(e){e.success&&Ye.html(e.count>1e4?(e.count/1e4).toFixed(1)+"w":e.count).data("count",e.count)}).always(function(){if(e)var t=setTimeout(function(){clearTimeout(t),t=null,d(e)},6e4)})}function r(){sibRooms||(Ye.data("count",pt),pt<Pt?(clearInterval($n),$n=null,ft<0&&(ft=Xe.children("li").length),Ye.html(pt),et.hide()):$n||o())}function u(e){var t="",n=ze.children("li");if(n.length>=qt){n.eq(0).remove()}t=cn?'<li class="sys-info msg-gift"><div class="new-reward-notice-content font-size-12"><p>'+unick+"&nbsp;</p><p> "+i18nText.chatPresented+" "+reward_text+'</p><img src="'+reward_content.gimg+'"></div></li>':'<li class="sys-info msg-gift"><span>'+e.nick+"</span> "+(customTemplate?"presented a flower":i18nText.chatPresented+i18nText.flowers)+' <img src="//livestatic.videocc.net/assets/wimages/gift-flower.png"></li>',ze.append(t),Wt=ze[0].scrollHeight-Qe.height()-Qe.scrollTop()<120,Vn?Wt&&Qe.scrollTop(ze[0].scrollHeight):Wt?Qe.scrollTop(ze[0].scrollHeight):$(".new-msg").fadeIn(),Vn=!1}function c(e){var t=e.content;M([{user:{uid:"1",nick:"系统",pic:"//livestatic.videocc.net/assets/wimages/pc_images/ds80x80.png",roomId:e.roomId},time:(new Date).getTime(),content:t}]);var n="",a=t.unick,i=t.rewardContent;if(!t.gimg&&(n=a+i18nText.chatRewarded+i+i18nText.yuan,canSendBarr&&"function"==typeof sendBarrage&&n))try{sendBarrage(n)}catch(e){console.log(e)}var o=e.content.rewardUser,s=!0;o&&o.userId!==userinfo.userId&&onlyTeacher&&(s=!1),s&&bn.reward(t)}function l(e){for(var t=e.length,n=0;n<t;n++)if("chatImg"!==e[n].msgSource){var a=e[n].content;marqueeEnabled&&"manager"==e[n].user.userType&&X(a);var i=a.replace(/\n/g,"");if(i=T(i),i=b(i,2),(!onlyTeacher||Ct==e[n].user.userId||"teacher"==e[n].user.userType||"manager"==e[n].user.userType||"assistant"==e[n].user.userType)&&canSendBarr&&"function"==typeof sendBarrage)try{sendBarrage(i)}catch(e){console.log(e)}}M(e)}function p(e,t){if(t>10)return it.hide(),void ot.html(i18nText.welcome+'<span class="txt-info">'+e[0].user.nick+'</span>、<span class="txt-info">'+e[1].user.nick+'</span>、<span class="txt-info">'+e[2].user.nick+"</span>"+i18nText.welcomeMoreETC+'<span class="txt-danger">'+t+"</span>"+i18nText.welcomeMore+i18nText.welcome).show();at.text(e.user.nick).attr("title",e.user.nick),it.show(),ot.hide()}function f(e){return e>=1e4&&e<1e5?(e=(e/1e4).toFixed(2),e=e.substring(0,e.length-1)+"w"):e>=1e5&&(e=Math.floor(e/1e4)+"w"),e}function h(e){if(cn){if($(".icon-like").length<=30){var t=Math.ceil(3*Math.random()),n=Math.floor(30*Math.random()),a=Math.floor(40*Math.random());$(".talk-input-wrap").append('<span class="icon-like like-'+t+'" style="right:'+n+'px;"></span>'),$(".icon-like").animate({bottom:190,right:a,opacity:0},2e3,function(){$(this).remove()})}}else"Y"==logoPc&&($(".like-msg").show(),nt.text(e).attr("title",e),Tn=0)}function m(e){var t=Gn+e.count;tt.html(f(t)).data("likenum",t),Gn=t,h(e.nick)}function v(e){$('li[data-socketid="'+e+'"]').remove(),ft--}function g(e){un&&rn&&(un=!1,Qe.prepend('<div class="polyv-icon-loading" id="historyLoading"></div>'),e||(e=0),t(xt,{roomId:Lt,start:e,isTransmitChannel:window.isTransmitChannel}).done(function(t){if(rn=t&&t.length>=10,t&&t.length){var n=t.slice(0,10);0!=e?M(n,!0):M(n.reverse())}}).always(function(e,t){un=!0,$("#historyLoading").remove(),"success"!==t&&console.info("加载聊天消息失败")}))}function w(){for(var e=0;e<kn.length;e++)clearTimeout(kn[e]),kn[e]=null}function y(t,n){e(xt,{roomId:Lt,startTime:t,endTime:n},!1).done(function(e){if(e&&e.length){var n=0,a=0;t==startTime&&0==qn&&ze.html(""),w(),Pn&&(ze.html(""),t=Wn);for(var i=0;i<e.length;i++){n=e[i].time,a=n-t;var o=e[i];!function(t,n){var i=JSON.parse(o.user);e[t].timer=setTimeout(function(){if(M([{user:i,time:(new Date).getTime(),content:n}]),canSendBarr&&"function"==typeof sendBarrage&&!hasPlaybackVideo){var e=n;if(1!=i.uid&&2!=i.uid&&3!=i.uid){e=e.replace(/\n/g,""),e=T(e),e=b(n,2);try{sendBarrage(e)}catch(e){console.log(e)}}}},a),kn.push(e[t].timer)}(i,o.content)}Pn=!1}})}function b(e,t){if("string"!=typeof e)return e;1!==t&&2!==t&&(t=1);var n=e,a=n.match(/\[[^\[\]]+?\]/g);return a&&a.forEach(function(e){var a=window.plvEmotion.parseEmotions(e,t);e!==a&&(n=n.replace(e,a))}),n}function T(e){return"string"!=typeof e?e:e?e.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim():e}function k(e){return e<10?"0"+e:e}function x(e){var t=new Date(e),n=t.toLocaleDateString(),a="";return xn!=n&&(a=n+" "),a+=k(t.getHours())+":"+k(t.getMinutes()),'<li class="sys-info msg-time" data-time="'+e+'">'+a+"</li>"}function I(e){var t=e.server_time||e.time,n=e.content;"string"==typeof n&&(n=JSON.parse(n));var a=T(n.unick),i=T(n.rewardContent),o="<div>",s="other-user-msg";e.content&&e.content.rewardUser&&(s=e.content.rewardUser.userId!==userinfo.userId?"other-user-msg":"");var d="other-user-msg"===s&&onlyTeacher?"hide-msg":"",r='<li data-type="'+s+'" data-time="'+t+'" class="msg msg-gift sys-info '+d,u=n.goodNum||1;return a?cn?(r+=" reward-notice",o='<div class="new-reward-notice-content font-size-12"><p>'+a+"&nbsp;</p><p>",n.gimg?o+=i18nText.chatPresented+'</p><img src="'+n.gimg+'">':o+=i18nText.chatRewarded+" ¥"+i+"</p>",o+="</div>"):n.gimg?o+=a+" "+i18nText.chatPresented+' <span class="new-reward-notice-gift-content"><img src="'+n.gimg+'" width="30px" height="30px"/></span>':o+='<img src="//livestatic.videocc.net/assets/wimages/icon-redpaper.png" width="30px" height="30px" style="border-radius: 0;">'+a+" "+i18nText.chatRewarded+" "+i+i18nText.yuan:(n=T(e.content),cn?e.image?o+=' <img src="'+e.image+'" width="30px" height="30px" style="border-radius: 50%;"/>':o+='<img src="//livestatic.videocc.net/assets/wimages/icon-redpaper.png" width="30px" height="30px">'+n:e.image?o+='<img src="'+e.image+'" width="30px" height="30px"/>':o+='<img src="//livestatic.videocc.net/assets/wimages/icon-redpaper.png" width="30px" height="30px" style="border-radius: 0;">'+n),u>1&&(o+="<span>x"+u+"</span>"),o+="</div>",r+='">'+o+"</li>"}function S(e){var t=e.server_time||e.time,n='<li data-time="'+t+'" class="msg msg-gift sys-info msg-custom">',a="";return a=void 0!=e.image?'<img src="'+e.image+'" width="30px" height="30px"/>':"",n+=e.content+a+"</li>"}function C(e){var t=e.server_time||e.time;if((Ct==e.user.userId||"redpaper"==e.msgSource&&Ct==e.user.openId)&&n.addClass("clearfix right"),cn){var n='<li data-time="'+t+'" class="msg msg-gift sys-info">';if(e.openId&&e.openId==sendRedPackId){if(e.openId!=e.getOpenId){var a="<div>"+e.nickname+i18nText.rpGetYour+"</div>";return n+=a+"</li>"}return""}if(e.getOpenId===sendRedPackId&&e.senderNick&&e.openId!==e.getOpenId){var a="<div>"+i18nText.rpGetPart1+e.senderNick+i18nText.rpGetPart2+"</div>";return n+=a+"</li>"}return""}return""}function _(e){for(var t=0,n=[],a=0,i=e.length;a<i;a++){var o=e.charCodeAt(a);if(0!=t){if(o>=56320&&o<=57343){var s=o,d=1024*(t-55296)+65536+(s-56320);n.push(d)}t=0}else o>=55296&&o<=56319?t=o:n.push(o)}return n}function E(e){for(var t,n=[],a=_(e),i=0,o=a.length;i<o;i++)t=a[i].toString(16),n.push("0000".substr(t.length)+t);return n.join("-")}function O(e){if("string"!=typeof e)return e;var t=/\ud83d\ude04|\ud83d\ude03|\ud83d\ude00|\ud83d\ude0a|\u263a\ufe0f|\ud83d\ude09|\ud83d\ude0d|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude17|\ud83d\ude19|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1b|\ud83d\ude33|\ud83d\ude01|\ud83d\ude14|\ud83d\ude0c|\ud83d\ude12|\ud83d\ude1e|\ud83d\ude23|\ud83d\ude22|\ud83d\ude02|\ud83d\ude2d|\ud83d\ude2a|\ud83d\ude25|\ud83d\ude30|\ud83d\ude05|\ud83d\ude13|\ud83d\ude29|\ud83d\ude2b|\ud83d\ude28|\ud83d\ude31|\ud83d\ude20|\ud83d\ude21|\ud83d\ude24|\ud83d\ude16|\ud83d\ude06|\ud83d\ude0b|\ud83d\ude37|\ud83d\ude0e|\ud83d\ude34|\ud83d\ude35|\ud83d\ude32|\ud83d\ude1f|\ud83d\ude26|\ud83d\ude27|\ud83d\ude08|\ud83d\udc7f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude10|\ud83d\ude15|\ud83d\ude2f|\ud83d\ude36|\ud83d\ude07|\ud83d\ude0f|\ud83d\ude11|\ud83d\udc72|\ud83d\udc73|\ud83d\udc6e|\ud83d\udc77|\ud83d\udc82|\ud83d\udc76|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc74|\ud83d\udc75|\ud83d\udc71|\ud83d\udc7c|\ud83d\udc78|\ud83d\ude3a|\ud83d\ude38|\ud83d\ude3b|\ud83d\ude3d|\ud83d\ude3c|\ud83d\ude40|\ud83d\ude3f|\ud83d\ude39|\ud83d\ude3e|\ud83d\udc79|\ud83d\udc7a|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\udc80|\ud83d\udc7d|\ud83d\udca9|\ud83d\udd25|\u2728|\ud83c\udf1f|\ud83d\udcab|\ud83d\udca5|\ud83d\udca2|\ud83d\udca6|\ud83d\udca7|\ud83d\udca4|\ud83d\udca8|\ud83d\udc42|\ud83d\udc40|\ud83d\udc43|\ud83d\udc45|\ud83d\udc44|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4c|\ud83d\udc4a|\u270a|\u270c\ufe0f|\ud83d\udc4b|\u270b|\ud83d\udc50|\ud83d\udc46|\ud83d\udc47|\ud83d\udc49|\ud83d\udc48|\ud83d\ude4c|\ud83d\ude4f|\u261d\ufe0f|\ud83d\udc4f|\ud83d\udcaa|\ud83d\udeb6|\ud83c\udfc3|\ud83d\udc83|\ud83d\udc6b|\ud83d\udc6a|\ud83d\udc6c|\ud83d\udc6d|\ud83d\udc8f|\ud83d\udc91|\ud83d\udc6f|\ud83d\ude46|\ud83d\ude45|\ud83d\udc81|\ud83d\ude4b|\ud83d\udc86|\ud83d\udc87|\ud83d\udc85|\ud83d\udc70|\ud83d\ude4e|\ud83d\ude4d|\ud83d\ude47|\ud83c\udfa9|\ud83d\udc51|\ud83d\udc52|\ud83d\udc5f|\ud83d\udc5e|\ud83d\udc61|\ud83d\udc60|\ud83d\udc62|\ud83d\udc55|\ud83d\udc54|\ud83d\udc5a|\ud83d\udc57|\ud83c\udfbd|\ud83d\udc56|\ud83d\udc58|\ud83d\udc59|\ud83d\udcbc|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5b|\ud83d\udc53|\ud83c\udf80|\ud83c\udf02|\ud83d\udc84|\ud83d\udc9b|\ud83d\udc99|\ud83d\udc9c|\ud83d\udc9a|\u2764\ufe0f|\ud83d\udc94|\ud83d\udc97|\ud83d\udc93|\ud83d\udc95|\ud83d\udc96|\ud83d\udc9e|\ud83d\udc98|\ud83d\udc8c|\ud83d\udc8b|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc64|\ud83d\udc65|\ud83d\udcac|\ud83d\udc63|\ud83d\udcad|\ud83d\udc36|\ud83d\udc3a|\ud83d\udc31|\ud83d\udc2d|\ud83d\udc39|\ud83d\udc30|\ud83d\udc38|\ud83d\udc2f|\ud83d\udc28|\ud83d\udc3b|\ud83d\udc37|\ud83d\udc3d|\ud83d\udc2e|\ud83d\udc17|\ud83d\udc35|\ud83d\udc12|\ud83d\udc34|\ud83d\udc11|\ud83d\udc18|\ud83d\udc3c|\ud83d\udc27|\ud83d\udc26|\ud83d\udc24|\ud83d\udc25|\ud83d\udc23|\ud83d\udc14|\ud83d\udc0d|\ud83d\udc22|\ud83d\udc1b|\ud83d\udc1d|\ud83d\udc1c|\ud83d\udc1e|\ud83d\udc0c|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc20|\ud83d\udc1f|\ud83d\udc2c|\ud83d\udc33|\ud83d\udc0b|\ud83d\udc04|\ud83d\udc0f|\ud83d\udc00|\ud83d\udc03|\ud83d\udc05|\ud83d\udc07|\ud83d\udc09|\ud83d\udc0e|\ud83d\udc10|\ud83d\udc13|\ud83d\udc15|\ud83d\udc16|\ud83d\udc01|\ud83d\udc02|\ud83d\udc32|\ud83d\udc21|\ud83d\udc0a|\ud83d\udc2b|\ud83d\udc2a|\ud83d\udc06|\ud83d\udc08|\ud83d\udc29|\ud83d\udc3e|\ud83d\udc90|\ud83c\udf38|\ud83c\udf37|\ud83c\udf40|\ud83c\udf39|\ud83c\udf3b|\ud83c\udf3a|\ud83c\udf41|\ud83c\udf43|\ud83c\udf42|\ud83c\udf3f|\ud83c\udf3e|\ud83c\udf44|\ud83c\udf35|\ud83c\udf34|\ud83c\udf32|\ud83c\udf33|\ud83c\udf30|\ud83c\udf31|\ud83c\udf3c|\ud83c\udf10|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1a|\ud83c\udf11|\ud83c\udf12|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf16|\ud83c\udf17|\ud83c\udf18|\ud83c\udf1c|\ud83c\udf1b|\ud83c\udf19|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf0f|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf20|\u2b50\ufe0f|\u2600\ufe0f|\u26c5\ufe0f|\u2601\ufe0f|\u26a1\ufe0f|\u2614\ufe0f|\u2744\ufe0f|\u26c4\ufe0f|\ud83c\udf00|\ud83c\udf01|\ud83c\udf08|\ud83c\udf0a|\ud83c\udf8d|\ud83d\udc9d|\ud83c\udf8e|\ud83c\udf92|\ud83c\udf93|\ud83c\udf8f|\ud83c\udf86|\ud83c\udf87|\ud83c\udf90|\ud83c\udf91|\ud83c\udf83|\ud83d\udc7b|\ud83c\udf85|\ud83c\udf84|\ud83c\udf81|\ud83c\udf8b|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf88|\ud83c\udf8c|\ud83d\udd2e|\ud83c\udfa5|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfc|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbb|\ud83d\udcf1|\u260e\ufe0f|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udd0a|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd14|\ud83d\udd15|\ud83d\udce2|\ud83d\udce3|\u23f3|\u231b\ufe0f|\u23f0|\u231a\ufe0f|\ud83d\udd13|\ud83d\udd12|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd0e|\ud83d\udca1|\ud83d\udd26|\ud83d\udd06|\ud83d\udd05|\ud83d\udd0c|\ud83d\udd0b|\ud83d\udd0d|\ud83d\udec1|\ud83d\udec0|\ud83d\udebf|\ud83d\udebd|\ud83d\udd27|\ud83d\udd29|\ud83d\udd28|\ud83d\udeaa|\ud83d\udeac|\ud83d\udca3|\ud83d\udd2b|\ud83d\udd2a|\ud83d\udc8a|\ud83d\udc89|\ud83d\udcb0|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcb3|\ud83d\udcb8|\ud83d\udcf2|\ud83d\udce7|\ud83d\udce5|\ud83d\udce4|\u2709\ufe0f|\ud83d\udce9|\ud83d\udce8|\ud83d\udcef|\ud83d\udceb|\ud83d\udcea|\ud83d\udcec|\ud83d\udced|\ud83d\udcee|\ud83d\udce6|\ud83d\udcdd|\ud83d\udcc4|\ud83d\udcc3|\ud83d\udcd1|\ud83d\udcca|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcdc|\ud83d\udccb|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc1|\ud83d\udcc2|\u2702\ufe0f|\ud83d\udccc|\ud83d\udcce|\u2712\ufe0f|\u270f\ufe0f|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd5|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd2|\ud83d\udcda|\ud83d\udcd6|\ud83d\udd16|\ud83d\udcdb|\ud83d\udd2c|\ud83d\udd2d|\ud83d\udcf0|\ud83c\udfa8|\ud83c\udfac|\ud83c\udfa4|\ud83c\udfa7|\ud83c\udfbc|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb9|\ud83c\udfbb|\ud83c\udfba|\ud83c\udfb7|\ud83c\udfb8|\ud83d\udc7e|\ud83c\udfae|\ud83c\udccf|\ud83c\udfb4|\ud83c\udc04\ufe0f|\ud83c\udfb2|\ud83c\udfaf|\ud83c\udfc8|\ud83c\udfc0|\u26bd\ufe0f|\u26be\ufe0f|\ud83c\udfbe|\ud83c\udfb1|\ud83c\udfc9|\ud83c\udfb3|\u26f3\ufe0f|\ud83d\udeb5|\ud83d\udeb4|\ud83c\udfc1|\ud83c\udfc7|\ud83c\udfc6|\ud83c\udfbf|\ud83c\udfc2|\ud83c\udfca|\ud83c\udfc4|\ud83c\udfa3|\u2615\ufe0f|\ud83c\udf75|\ud83c\udf76|\ud83c\udf7c|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf78|\ud83c\udf79|\ud83c\udf77|\ud83c\udf74|\ud83c\udf55|\ud83c\udf54|\ud83c\udf5f|\ud83c\udf57|\ud83c\udf56|\ud83c\udf5d|\ud83c\udf5b|\ud83c\udf64|\ud83c\udf71|\ud83c\udf63|\ud83c\udf65|\ud83c\udf59|\ud83c\udf58|\ud83c\udf5a|\ud83c\udf5c|\ud83c\udf72|\ud83c\udf62|\ud83c\udf61|\ud83c\udf73|\ud83c\udf5e|\ud83c\udf69|\ud83c\udf6e|\ud83c\udf66|\ud83c\udf68|\ud83c\udf67|\ud83c\udf82|\ud83c\udf70|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6f|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf4a|\ud83c\udf4b|\ud83c\udf52|\ud83c\udf47|\ud83c\udf49|\ud83c\udf53|\ud83c\udf51|\ud83c\udf48|\ud83c\udf4c|\ud83c\udf50|\ud83c\udf4d|\ud83c\udf60|\ud83c\udf46|\ud83c\udf45|\ud83c\udf3d|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfeb|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfea|\ud83c\udfe9|\ud83c\udfe8|\ud83d\udc92|\u26ea\ufe0f|\ud83c\udfec|\ud83c\udfe4|\ud83c\udf07|\ud83c\udf06|\ud83c\udfef|\ud83c\udff0|\u26fa\ufe0f|\ud83c\udfed|\ud83d\uddfc|\ud83d\uddfe|\ud83d\uddfb|\ud83c\udf04|\ud83c\udf05|\ud83c\udf03|\ud83d\uddfd|\ud83c\udf09|\ud83c\udfa0|\ud83c\udfa1|\u26f2\ufe0f|\ud83c\udfa2|\ud83d\udea2|\u26f5\ufe0f|\ud83d\udea4|\ud83d\udea3|\u2693\ufe0f|\ud83d\ude80|\u2708\ufe0f|\ud83d\udcba|\ud83d\ude81|\ud83d\ude82|\ud83d\ude8a|\ud83d\ude89|\ud83d\ude9e|\ud83d\ude86|\ud83d\ude84|\ud83d\ude85|\ud83d\ude88|\ud83d\ude87|\ud83d\ude9d|\ud83d\ude8b|\ud83d\ude83|\ud83d\ude8e|\ud83d\ude8c|\ud83d\ude8d|\ud83d\ude99|\ud83d\ude98|\ud83d\ude97|\ud83d\ude95|\ud83d\ude96|\ud83d\ude9b|\ud83d\ude9a|\ud83d\udea8|\ud83d\ude93|\ud83d\ude94|\ud83d\ude92|\ud83d\ude91|\ud83d\ude90|\ud83d\udeb2|\ud83d\udea1|\ud83d\ude9f|\ud83d\udea0|\ud83d\ude9c|\ud83d\udc88|\ud83d\ude8f|\ud83c\udfab|\ud83d\udea6|\ud83d\udea5|\u26a0\ufe0f|\ud83d\udea7|\ud83d\udd30|\u26fd\ufe0f|\ud83c\udfee|\ud83c\udfb0|\u2668\ufe0f|\ud83d\uddff|\ud83c\udfaa|\ud83c\udfad|\ud83d\udccd|\ud83d\udea9|\ud83c\uddef\ud83c\uddf5|\ud83c\uddf0\ud83c\uddf7|\ud83c\udde9\ud83c\uddea|\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\uddee\ud83c\uddf9|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddec\ud83c\udde7|\u0031\ufe0f\u20e3|\u0032\ufe0f\u20e3|\u0033\ufe0f\u20e3|\u0034\ufe0f\u20e3|\u0035\ufe0f\u20e3|\u0036\ufe0f\u20e3|\u0037\ufe0f\u20e3|\u0038\ufe0f\u20e3|\u0039\ufe0f\u20e3|\u0030\ufe0f\u20e3|\ud83d\udd1f|\ud83d\udd22|\u0023\ufe0f\u20e3|\ud83d\udd23|\u2b06\ufe0f|\u2b07\ufe0f|\u2b05\ufe0f|\u27a1\ufe0f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd24|\u2197\ufe0f|\u2196\ufe0f|\u2198\ufe0f|\u2199\ufe0f|\u2194\ufe0f|\u2195\ufe0f|\ud83d\udd04|\u25c0\ufe0f|\u25b6\ufe0f|\ud83d\udd3c|\ud83d\udd3d|\u21a9\ufe0f|\u21aa\ufe0f|\u2139\ufe0f|\u23ea|\u23e9|\u23eb|\u23ec|\u2935\ufe0f|\u2934\ufe0f|\ud83c\udd97|\ud83d\udd00|\ud83d\udd01|\ud83d\udd02|\ud83c\udd95|\ud83c\udd99|\ud83c\udd92|\ud83c\udd93|\ud83c\udd96|\ud83d\udcf6|\ud83c\udfa6|\ud83c\ude01|\ud83c\ude2f\ufe0f|\ud83c\ude33|\ud83c\ude35|\ud83c\ude34|\ud83c\ude32|\ud83c\ude50|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude36|\ud83c\ude1a\ufe0f|\ud83d\udebb|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebc|\ud83d\udebe|\ud83d\udeb0|\ud83d\udeae|\ud83c\udd7f\ufe0f|\u267f\ufe0f|\ud83d\udead|\ud83c\ude37|\ud83c\ude38|\ud83c\ude02|\u24c2\ufe0f|\ud83d\udec2|\ud83d\udec4|\ud83d\udec5|\ud83d\udec3|\ud83c\ude51|\u3299\ufe0f|\u3297\ufe0f|\ud83c\udd91|\ud83c\udd98|\ud83c\udd94|\ud83d\udeab|\ud83d\udd1e|\ud83d\udcf5|\ud83d\udeaf|\ud83d\udeb1|\ud83d\udeb3|\ud83d\udeb7|\ud83d\udeb8|\u26d4\ufe0f|\u2733\ufe0f|\u2747\ufe0f|\u274e|\u2705|\u2734\ufe0f|\ud83d\udc9f|\ud83c\udd9a|\ud83d\udcf3|\ud83d\udcf4|\ud83c\udd70|\ud83c\udd71|\ud83c\udd8e|\ud83c\udd7e|\ud83d\udca0|\u27bf|\u267b\ufe0f|\u2648\ufe0f|\u2649\ufe0f|\u264a\ufe0f|\u264b\ufe0f|\u264c\ufe0f|\u264d\ufe0f|\u264e\ufe0f|\u264f\ufe0f|\u2650\ufe0f|\u2651\ufe0f|\u2652\ufe0f|\u2653\ufe0f|\u26ce|\ud83d\udd2f|\ud83c\udfe7|\ud83d\udcb9|\ud83d\udcb2|\ud83d\udcb1|\u00a9|\u00ae|\u2122|\u274c|\u203c\ufe0f|\u2049\ufe0f|\u2757\ufe0f|\u2753|\u2755|\u2754|\u2b55\ufe0f|\ud83d\udd1d|\ud83d\udd1a|\ud83d\udd19|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd03|\ud83d\udd5b|\ud83d\udd67|\ud83d\udd50|\ud83d\udd5c|\ud83d\udd51|\ud83d\udd5d|\ud83d\udd52|\ud83d\udd5e|\ud83d\udd53|\ud83d\udd5f|\ud83d\udd54|\ud83d\udd60|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd61|\ud83d\udd62|\ud83d\udd63|\ud83d\udd64|\ud83d\udd65|\ud83d\udd66|\u2716\ufe0f|\u2795|\u2796|\u2797|\u2660\ufe0f|\u2665\ufe0f|\u2663\ufe0f|\u2666\ufe0f|\ud83d\udcae|\ud83d\udcaf|\u2714\ufe0f|\u2611\ufe0f|\ud83d\udd18|\ud83d\udd17|\u27b0|\u3030|\u303d\ufe0f|\ud83d\udd31|\u25fc\ufe0f|\u25fb\ufe0f|\u25fe\ufe0f|\u25fd\ufe0f|\u25aa\ufe0f|\u25ab\ufe0f|\ud83d\udd3a|\ud83d\udd32|\ud83d\udd33|\u26ab\ufe0f|\u26aa\ufe0f|\ud83d\udd34|\ud83d\udd35|\ud83d\udd3b|\u2b1c\ufe0f|\u2b1b\ufe0f|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39/g;return e.replace(t,function(e){return'<img class="emoji" src="//livestatic.videocc.net/assets/emoji/'+E(e)+'.png">'})}function L(e,t){if(e.user){"string"==typeof e.user&&(e.user=JSON.parse(e.user)),e.msgSource||"chatImg"!==e.msgType||(e.msgSource=e.msgType);var n={TEACHER:customTemplate?"teacher":"讲师",MANAGER:customTemplate?"admin":"管理员",ASSISTANT:customTemplate?"assistant":"助教",GUEST:customTemplate?"guest":"嘉宾"},a="",o=e.user.userType||"",s=e.user.authorization||"",d=e.user.actor||n[o.toUpperCase()]||"",r=onlyTeacher&&Ct!=e.user.userId&&"teacher"!=o&&"manager"!=o&&"assistant"!=o;if(t?(!r&&Sn-e.time>12e4&&(a=x(e.time)),Sn=e.time):!r&&e.time-In>12e4&&(a=x(e.time),In=e.time),"customMessage"===e.msgType)return i(e.tip||"发送了自定义消息"),"";if(1==e.user.uid)return a+I(e);e.content=T(e.content);var u=e.content;if(e.user.nick=T(e.user.nick),e.content=b(e.content),!wn&&e.content&&(e.content=O(e.content)),2==e.user.uid)return window.showCustomMsg?S(e):"";if(3==e.user.uid)return C(e);"chatImg"!==e.msgSource&&(e.content=e.content.replace(/\r?\n/g,"<br/>")),"chatImg"===e.msgSource||""==e.content||"teacher"!=o&&"manager"!=o&&"assistant"!=o||-1!==e.content.indexOf("plv-emotion-img")||(e.content=H(e.content));var c=a+'<li id="'+e.id+'" data-time="'+(e.server_time||e.time)+'" data-type="';if(Ct==e.user.userId||"redpaper"==e.msgSource&&Ct==e.user.openId)c+="my";else switch(o){case"teacher":case"manager":case"assistant":c+=o;break;default:c+="other-user"}c+='-msg" class="msg',r&&(c+=" hide-msg"),(Ct==e.user.userId||"redpaper"==e.msgSource&&Ct==e.user.openId)&&(c+=" clearfix right"),c+='">',customTemplate&&("teacher"==e.user.userType?e.user.nick="teacher":"manager"==o&&"管理员"==e.user.nick&&(e.user.nick="admin"));c+='<div class="talk-logo"><img src="'+e.user.pic+'"></div>';var l='<div class="talk-box"><p class="talk-info">',p='<div class="talk-txt"><p class="talk-main',f=!1;if("chatImg"===e.msgSource){"string"==typeof e.content&&(e.content=JSON.parse(e.content));var h=e.content.uploadImgUrl;h=h&&h.replace(/^http(s?):/i,""),h=location.protocol+h;var m=e.content.id||"";if(on.push(h),$("#"+m).length>0)return $("#"+m).attr("src",h).parents("li").attr("id",e.id),"";var v=Ct==e.user.userId?'<span class="chatImgFailIcon"></span>':"";e.content=v+'<img style="image-orientation: from-image" id="'+m+'" class="img-msg" src="'+h+'"',f=!0}p+='" data-content="'+u+'" rel="'+e.user.nick,("teacher"==o||"manager"==o||"assistant"==o&&"Visitor"!=e.user.role)&&(p+='" style="color:#2196f3',l+='</span><span class="vip">'),""!==s&&s.actor&&(l+='<span class="vip" style="color:'+s.fColor+"; background-color: "+s.bgColor+'">'+s.actor),l+="assistant"===o&&"Visitor"===e.user.role?"":d,l+='</span><span class="talk-name">'+e.user.nick+"</span></p>",p+='">'+e.content+"</p>";if(translateEnabled&&!f&&mn.needTranslate(e.content)&&(p+='<img class="btn-translate" src="/assets/wimages/icon-translate-orange.png" />'),p+="</div>","redpaper"==e.msgSource){var g=e.redCacheId,w=e.redpackId,y=e.number,k=e.user.openId,_=e.user.nick;p=cn?'<div id="getOpenId" class="redpaper-msg talk-txt" data-openid= "'+k+'" data-unick="'+_+'" cid="'+g+'" number="'+y+'" rid="'+w+'"><div class="redpaper-msg-content"><p class="redpaper-text">'+e.content+"</p><p>"+i18nText.rpGet2+"</p></div></div>":'<div class="talk-txt"><p class="talk-main" data-content="'+u+'" rel="'+e.user.nick+'" style="color:#ff8c00">'+i18nText.rpSendMsg+"</p></div>"}return l+=p+"</div>",c+=l}}function N(){onlyTeacher?ze.find("li").each(function(){var e=$(this);"other-user-msg"==e.data("type")&&(e.addClass("hide-msg"),e.prev().hasClass("msg-time")&&e.prev().hide())}):(ze.children("li.hide-msg").removeClass("hide-msg"),$(".msg-time").show(),ze.scrollTop(ze[0].scrollHeight))}function M(e,t){var n=[];if(t){Sn=ze.children("li").eq(0).data("time");for(var a=0;a<e.length;a++){var i=e[a];n.unshift(L(i,t))}return ze.prepend(n.join("")),N(),void setTimeout(function(){Qe.scrollTop(600)},0)}for(var a=0;a<e.length;a++)n.push(L(e[a]));var o=ze.children("li"),s=o.length,d=s+n.length,r=!0;if(d>qt){var u=d-qt,c=ze.html(),l=c.split("</li>");l.splice(0,u),c=l.join("</li>,"),l=c.split(","),l.pop(),n=l.concat(n),r=!1}Wt=ze[0].scrollHeight-Qe.height()-Qe.scrollTop()<120,r?ze.append(n.join("")):ze.html(n.join(""));var p=setTimeout(function(){Wt||Rn?Qe.scrollTop(ze[0].scrollHeight):$(".new-msg").fadeIn(),Rn=!1,clearTimeout(p),p=null},300)}function A(e){var t=[],n=!1;if(e instanceof Array)t=e.slice(0);else{if(Xe.children("li").length>=Pt||!nn[e.uid])return;t.push(e),n=!0}for(var a=t.length,i=[],o=0;o<a;o++){var s,d=t[o],r=d.userType,u=d.authorization?d.authorization:"";d.nick=T(d.nick),an[d.userId]=d,"teacher"===r&&(yt=d.userId,callInteraction&&callInteraction.setTeacherId(yt)),"Visitor"===d.role&&(r="student",-1!=d.pic.indexOf("assistant")&&(d.pic="//livestatic.videocc.net/assets/wimages/missing_face.png"));var c="";if(d.userId==Ct){if(Cn)continue;d.nick=d.nick+(customTemplate?"(me)":"(我)"),$t=d.uid,Cn=!0,c='id="'+d.userId+'"'}s="<li "+c+' data-socketid="'+d.uid,customTemplate&&("teacher"===r?d.nick="teacher":"manager"===r&&"管理员"==d.nick&&(d.nick="admin")),s+='"><div class="talk-info"><input type="hidden" name="user-type" value="'+r+'"></div><div class="talk-logo"><img src="'+d.pic+'"/></div>',d.actor?s+='<span class="user-actor" title="'+d.actor+'">'+(customTemplate&&"管理员"==d.actor?"admin":d.actor)+"</span>":("teacher"==r&&(s+='<span class="user-actor">'+(customTemplate?"teacher":"讲师")+"</span>"),"manager"==r&&(s+='<span class="user-actor">'+(customTemplate?"admin":"管理员")+"</span>")),""!==u&&u.actor&&(s+='<span class="user-actor" title="'+u.actor+'" style="color:'+u.fColor+"; background-color: "+u.bgColor+'">'+u.actor+"</span>"),s+='<div class="talk-box" title="'+d.nick+'">'+d.nick+"</div></li>",i.push(s)}if(Cn||(Cn=!0,i.unshift('<li id="'+Ct+'" data-socketid="'+$t+'"><div class="talk-info"><input type="hidden" name="user-type" value="student"></div><div class="talk-logo"><img src="'+Nt+'"/></div><div class="talk-box">'+Et+"(我)</div></li>")),n){var l=e.userType,p=Xe.children('li[id="'+Ct+'"]'),f=$(i.join(""));if("manager"===l){var p=Xe.children('li[id="'+Ct+'"]');f.insertAfter(p)}else if("teacher"===l){var h=$('input[value="manager"]').parents("li:last");h.length&&(p=h),f.insertAfter(p)}else if("assistant"===l){var h=$('input[value="manager"]').parents("li:last"),m=$('input[value="teacher"]').parents("li:last"),v=$('input[value="assistant"]').parents("li:last");v.length?p=v:m.length?p=m:h.length&&(p=h),f.insertAfter(p)}else Xe.append(i.join(""))}else Xe.append(i.join(""))}function j(e){return function(t,n){var a=t[e],i=n[e];return a<i?1:a>i?-1:0}}function R(e){if(!(e instanceof Array)||e.length<0)return[];var t=Date.now(),n=0,a=e.length,i="";for(n=0;n<a;n++){var o=e[n];if(Ct!==o.userId)switch(o.userType){case"manager":e[n].priority="3";break;case"teacher":e[n].priority="2";break;case"assistant":e[n].priority="1";break;case"student":case"slice":default:for(i=String(t-Number(e[n].userId));i.length<13;)i="0"+i;e[n].priority=0+i}else e[n].priority="4"}return e.sort(j("priority")),e}function q(e){function t(e){if(e){var t=e.count;if(pt||(pt=t),cn)return void((chatOnlineNumberEnable||isCcb)&&r());if(chatOnlineNumberEnable&&!chaterListVisible)return void r();var n=R(JSON.parse(JSON.stringify(e.userlist))),i=n.length;a||(!sibRooms&&chatOnlineNumberEnable&&(pt=ft=t<Pt?i:t,r()),Xe.empty(),Cn=!1),A(n),i>=Pt?et.show():et.hide()}}var n=1,a=!1
;void 0!=e&&(n=e,a=!0);var i=xt+"/front/listUsers?roomId="+Lt+"&page="+n+"&len="+Pt;window.listUsersCallback=t,$.ajax({url:i,data:{toGetSubRooms:window.isTransmitChannel},cache:!0,type:"get",dataType:"jsonp",jsonpCallback:"listUsersCallback"})}function P(e){var t=parseInt(window.pageView),n=t+e;window.pageView=n}function W(){var e=window.showCurViewer?pt:parseInt(window.pageView),t=e;e>=1e5?(t=parseInt(e/1e4),t+="w"):e>=1e4&&(t=(e/1e4).toString().substr(0,3),t+="w"),Ke.html&&Ke.html()!==t+""&&Ke.html(t),Ze.html&&Ze.html()!==t+""&&Ze.html(t)}function H(e){if(!e)return e;var t=/(http:\/\/|https:\/\/)([\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?)/g;return e.replace(t,'<a style="color:#2196f3" target="_blank" href="$1$2">$1$2</a>')}function D(e,t,n,a){this.selector=e,this.el=null,this.isMobile=t,this.clickTouchType=n,this.maxInput=a||100,this.init=function(){var t=this;this.el=this.getElements(e),this.el.$curCount=$(this.el.$AQwrap).find(".curCount").eq(0),this.el.$emotionsWrap.html(window.plvEmotion.genDOMList()),this.el.$emotionSwitch.on(mt,function(){$("body").toggleClass(t.selector.faceLayerShow),t.el.$chatipt.blur()});var n={x:0,y:0};this.el.$emotionsWrap.on("touchstart","li",function(){n.x=event.changedTouches[0].pageX,n.y=event.changedTouches[0].pageY}).on(t.clickTouchType,"li",function(){var e=$(this).children(".plv-emotion-panel__item__ico"),n=e.data("title");"delContent"===n?t.delContent():t.addContent(n)})},this.getElements=function(e){var t,n={};if("object"===_typeof(e))for(t in e)0===t.search(/^\$/)&&(n[t]=$(e[t].replace(/(^\s*)|(\s*$)/g,"")));return n},this.addContent=function(e){var t=this.el.$chatipt.val(),n=t+"["+e+"]",a=this.el.$curCount,i=t.length+2+e.length;i>this.maxInput||(a.text(i),this.el.$chatipt.val(n))},this.delContent=function(){var e,t=this.el.$chatipt.val();if(t){e=t.lastIndexOf("]")===t.length-1?t.slice(0,t.lastIndexOf("[")):t.slice(0,t.length-1),this.el.$chatipt.val(e)}}}function F(e,t,n){var a={$chatipt:"#chatipt_aq",$send:"#send_aq",$talkList:"#talkList_aq",$talk:"#talk_aq",$faceicon:"#faceicon_aq",$sendMsgWrap:"#sendMsgWrap_aq",$AQwrap:".ask-question-wrap"};this.data={},this.selector=a,this.el=null,this.isMobile=e,this.chatApiHost=t,this.myInfo=n,this.lastSendTime=null,this.init=function(){var e=this;e.el=e.getElements(a),e.handleAQSwitch(),e.getTeacherInfo(),e.el.$talk.scrollTop($(this.selector.$talkList).height()),new D({$emotionsWrap:"#facemain_aq",$emotionSwitch:"#faceicon_aq",emotionSwitch:"faceicon_aq",$chatipt:"#chatipt_aq",$sendMsgWrap:"#sendMsgWrap_aq",faceLayerShow:"face-layer-show",$AQwrap:".ask-question-wrap"},cn,mt).init(),e.el.$send.on(mt,function(){e.sendMessage()}),e.el.$chatipt.on("keypress",function(t){if(13===t.which)return e.sendMessage(),$(this).focus(),!1}),e.el.$talk.scroll(function(){(Wt=e.el.$talkList[0].scrollHeight-e.el.$talk.height()-e.el.$talk.scrollTop()<120)&&"block"==$(".quiz-new-msg").css("display")&&$(".quiz-new-msg").hide()}),$(".quiz-new-msg").on(mt,function(){e.el.$talk.scrollTop(e.el.$talkList[0].scrollHeight),$(this).fadeOut()})},this.getElements=function(e){var t,n={};if("object"===_typeof(e))for(t in e)0===t.search(/^\$/)&&(n[t]=$(e[t].replace(/(^\s*)|(\s*$)/g,"")));return n},this.getQuizHistoryContent=function(){var e=this.chatApiHost+"/front/getQuestionContent?roomId="+this.myInfo.roomName,t=this;$.ajax({url:e,type:"GET",dataType:"jsonp",async:!1,success:function(e){e&&e.length&&t.addList(e,!1)}})},this.getTeacherInfo=function(){this.addList([JSON.stringify({EVENT:"T_ANSWER",roomId:this.myInfo.roomName,user:teacherInfo,content:i18nText.askInitMsg,s_userId:this.myInfo.userId})],!1),this.getQuizHistoryContent()},this.handleAQSwitch=function(){var e=$(".ask-question-wrap>.panel"),t=$(".ask-question-wrap .close_panel"),n=$(".ask-question-wrap .question_btn"),a=$(".ask-question-wrap"),i=a.offsetParent(),o=$(document),s=!1;t.on("click",function(){e.hide(),n.show()}),a.on("mousedown",function(t){var d=$(t.target),r=t.clientX-this.offsetLeft,u=t.clientY-this.offsetTop,c=d.hasClass("question_btn")||d.parents(".question_btn").length>0,l=c?i.outerWidth()-n.outerWidth():i.outerWidth()-e.outerWidth(),p=c?i.outerHeight()-n.outerHeight():i.outerHeight()-e.outerHeight();o.on("mousemove",function(e){if(!d.parents(".panel_cont").length&&!d.parents(".question_btn").length){var t=e.clientX-r,n=e.clientY-u;if(t!==a[0].offsetLeft||n!==a[0].offsetTop){var i=l-t,o=p-n;i=i<0?0:i>l?l:i,o=o<0?0:o>p?p:o,a.css({right:i+"px",bottom:o+"px"}),s=!0}}}).on("mouseup",function(t){var d=$(t.target),r=i.outerWidth()-e.outerWidth(),u=i.outerHeight()-e.outerHeight();s?s=!1:d.parents(".question_btn").length&&(parseInt(a.css("right"))>r&&a.css({right:r+"px"}),parseInt(a.css("bottom"))>u&&a.css({bottom:u+"px"}),Dt&&(e.show(),n.hide(),lt.hide()),$(".ask-question-wrap .panel_cont .chat_list").scrollTop($(".ask-question-wrap .panel_cont .chat_list ul").height())),o.unbind("mousemove").unbind("mouseup")})})},this.sendMessage=function(){if(this.el.$chatipt.val()){var e=Date.now(),t=this;if(t.lastSendTime&&e-t.lastSendTime<3e3)return void t.addTip(i18nText.askTooFast);this.el.$AQwrap.find(".curCount").text("0"),t.lastSendTime=e;var n=this.el.$chatipt.val().replace(/(^\s*)|(\s*$)/g,"");n=n.substring(0,200);var a=this.myInfo;if(""!==n){var i={nick:a.userName,pic:a.pic,userId:a.userId,actor:"学生",userType:"student"},o={EVENT:"S_QUESTION",roomId:a.roomName,user:i,content:n},s=JSON.stringify(o);socket?Dt?socket.emit("message",s):t.addTip(i18nText.noNickname):t.addTip(i18nText.disconnectTip),this.el.$chatipt.val(""),$("body").removeClass("face-layer-show")}}},this.addTip=function(e){var t=$('<li class="sys-info">'+e+"</li>"),n=this;n.el.$talkList.append(t),n.el.$talk.scrollTop($(n.selector.$talkList).height())},this.createList=function(e){var t=$("<li />"),n="";e.content=T(e.content),e.s_userId&&(e.content=H(e.content)),e.content=b(e.content);var a=e.user,i=T(a.nick),o=a.pic,s=a.userId,d=a.actor;return"T_ANSWER"===e.EVENT||void 0===e.EVENT&&e.s_userId===Ct?(t.addClass("left"),n=$("<div class='user_avatar'><img src="+o+" alt=''></div><div class='user_message'><div class='user_info' data-userId='"+s+"'><span class='actor' title='"+d+"'>"+d+"</span><span class='nick' title='"+i+"'>"+i+"</span></div><div class='message talk-main'>"+e.content+"</div></div>")):("S_QUESTION"===e.EVENT||void 0===e.EVENT&&s===Ct)&&(t.addClass("right"),n="<div class='message talk-main'>"+e.content+"</div>"),t.append(n),t},this.addList=function(e,t){var n=$("#aq-panel");t&&"none"===n.css("display")&&lt.show();var a=this;$.each(e,function(e,t){"string"==typeof t&&(t=JSON.parse(t)),(t.user&&a.myInfo&&t.user.userId===a.myInfo.userId||t.s_userId===a.myInfo.userId)&&a.el.$talkList.append(a.createList(t))}),this.el.$talkList[0].scrollHeight-this.el.$talk.height()-this.el.$talk.scrollTop()<120||!t?this.el.$talk.scrollTop($(this.el.$talkList).height()):$(".quiz-new-msg").fadeIn()}}function G(e){this.$groupWrap=$(".group-wrap"),this.$groupMoveBtn=$(".group_mask"),this.$groupBtn=$(".group_btn"),this.$offsetParent=this.$groupWrap.offsetParent(),this.$groupParent=this.$groupWrap.parent(),this.$doc=$(document),this.switchChannel=e,this.init=function(){this.bindClick(),this.bindDrag()},this.bindClick=function(){var e=this;this.$groupBtn.on("click",function(){e.switchChannel&&window.open("//live.polyv.cn/watch/"+e.switchChannel,"_self")})},this.bindDrag=function(){var e=this;this.$groupMoveBtn.on("mousedown",function(t){var n=($(t.target),t.clientX-e.$groupWrap[0].offsetLeft),a=t.clientY-e.$groupWrap[0].offsetTop,i=e.$offsetParent.outerWidth()-e.$groupWrap.outerWidth(),o=e.$offsetParent.outerHeight()-e.$groupWrap.outerHeight(),s=!1;e.$doc.on("mousemove",function(t){var d=t.clientX-n,r=t.clientY-a;if(d!==e.$groupWrap[0].offsetLeft||r!==e.$groupWrap[0].offsetTop){var u=i-d,c=o-r;u=u<0?0:u>i?i:u,c=c<0?0:c>o?o:c,e.$groupWrap.css({right:u+"px",bottom:c+"px"}),s=!0}}).on("mouseup",function(){e.$doc.unbind("mousemove").unbind("mouseup")})})}}function V(e){"live"==e?($(".group_btn").hasClass("group-hide")&&$(".group_btn").toggleClass("group-hide"),"N"===isDebug&&dt.removeClass("group-hide")):(hasRecord||hasPlaybackVideo||$(".group_btn").hasClass("group-hide")||$(".group_btn").toggleClass("group-hide"),isReplay||dt.addClass("group-hide"))}function U(e,t,n){e.on("keyup",function(a){var i=$(a.target),o=i.val();o.length>n&&i.val(o.slice(0,n)),""!==t&&e.find(t).text(i.val().length)})}function B(e){var t=Ue.val(),n=t+"["+e+"]";Ue.val(n)}function z(){var e,t=Ue.val();if(t){e=t.lastIndexOf("]")===t.length-1?t.slice(0,t.lastIndexOf("[")):t.slice(0,t.length-1),Ue.val(e)}}function Q(){socket&&socket.close(),socket=null}function X(e){var t=0,n=$("#notice-marquee");n.length>0&&(n.marquee("destroy"),n.html(e),cn&&(n.parent("li").addClass("marquee-show"),$(".gonggao-msg").show()),n.bind("finished",function(){3==++t&&(t=0,$(this).marquee("destroy"),n.html(""),$(".gonggao-msg").hide(),cn&&n.parent("li").removeClass("marquee-show"))}).marquee())}function J(){return"live"!==livestatus||!streamStatus||cn||0!==On()?callInteraction:callInteraction?(callInteraction.setUserInfo({nick:Et,pic:Nt,userId:Rt,uid:socket.uid}),callInteraction):new Call({container:$(".mbox-rwrp"),socket:socket,sessionId:channelSessionId,channelId:Lt,nick:Et,pic:Nt,userId:Rt,uid:socket.uid,livestatus:livestatus,player:player,teacherId:yt,rtcEnabled:rtcEnabled,accountId:accountId,isCcb:isCcb,chatApiHost:xt,apiHost:It})}function Y(e){switch(e.EVENT){case"LOGIN":var t=e.user;if(an[t.userId]=t,P(1),"Y"===logoEnabled&&t.userId!=Ct&&Zt.push(e),pt=e.onlineUserNumber,t.userId==Ct)jn=!0,zt=t.banned,Tt=t.clientIp,$t=t.uid,Xe.children('li[id="'+Ct+'"]').length&&Xe.children('li[id="'+Ct+'"]').attr("data-socketid",$t),sibRooms&&d(!0);else{if("teacher"===t.userType&&"chatroom"===t.userSource){Qt=t;break}ft++,Jt.push(t),nn[t.uid]=t}(chatOnlineNumberEnable||cn&&isCcb)&&r();break;case"LOGOUT":pt=e.onlineUserNumber,(chatOnlineNumberEnable||cn&&isCcb)&&r();var n=e.uid;if(Qt&&Qt.uid===n){Qt=null;break}testUsersCount.logoutUser++;var a=nn[n];a&&delete an[a.userId],nn[n]=null,Yt.push(n);break;case"RELOGIN":$("#js-tip-content").html(i18nText&&i18nText.singleSessionVerifyTip2),$("#js-verify-tip").show(),$("#js-tip-btn-know").click(function(){window.location.replace("/error-verify?channelId="+window.currentChannelId)}),setTimeout(function(){window.location.replace("/error-verify?channelId="+window.currentChannelId)},5e3);break;case"CLOSEROOM":At=e.value.closed,chatEnable=!At,i(At?customTemplate?"The channel is temporarily closed.":i18nText.closeRoom:customTemplate?"The channel is now reopened.":i18nText.openRoom),Wt=ze[0].scrollHeight-Qe.height()-Qe.scrollTop()<120,Wt?Qe.scrollTop(ze[0].scrollHeight):$(".new-msg").fadeIn();break;case"GONGGAO":var o=e.content;o&&X(o);break;case"SPEAK":if("error"==e.status)return;if("censor"==e.status){ze.children("li").last().attr("id",e.id);break}if(e.user.userId==Ct)break;if($("#"+e.id).length)break;Xt.push({id:e.id,time:e.time,content:e.values[0],user:e.user});break;case"CHAT_IMG":if(ze.children("#"+e.id).length)break;!e.result&&Wa?He({id:Wa,imgSrc:null,status:"forbid"}):Xt.push({id:e.id,time:e.time,content:e.values[0],user:e.user,msgSource:"chatImg"});break;case"REWARD":en.push(e);break;case"ANSWER":if("undefined"!=typeof answerCount){answerCount++,$("#answerCount").text(answerCount);var u=e.answer;$("#answerItem-list>li").each(function(){var e=$(this),t=e.find(".answer-count"),n=t.text();if(e.data("text")==u&&(n++,t.text(n)),0!=n){var a=100*(n/answerCount).toFixed(2);e.find(".progressbar").width(a+"%")}})}break;case"CUSTOMER_MESSAGE":if(!window.showCustomMsg)break;var c="",l="";void 0!=e.image&&(l='<img src="'+e.image+'"/>'),e.content=b(e.content),c='<li class="sys-info msg-gift msg-custom">'+e.content+l+"</li>";var p=ze.children("li");if(p.length>=qt){var f=p.eq(0);f.remove()}if(ze.append(c),"function"==typeof sendBarrage)try{sendBarrage(danmu_value)}catch(e){console.log(e)}Wt=ze[0].scrollHeight-Qe.height()-Qe.scrollTop()<120,Wt?Qe.scrollTop(ze[0].scrollHeight):$(".new-msg").fadeIn();break;case"KICK":var h=e.user;if(!h)break;"ip"===h.kickRefer?h.clientIp===Tt&&(ct=!0):h.userId==Ct&&(ct=!0),ct&&($(".mask,#kick-tip-wrap").show(),callInteraction&&(callInteraction.isJoined?callInteraction.leaveCall():callInteraction.isRaise&&callInteraction.btnRaise.trigger("click")),socket&&socket.close(),player&&"function"==typeof player.destroy?player.destroy():$(".player-box,.player-main").remove());break;case"LOGIN_REFUSE":ct=!0,$(".mask,#kick-tip-wrap").show(),socket&&socket.close(),player&&"function"==typeof player.destroy?player.destroy():$(".player-box,.player-main").remove();break;case"REMOVE_HISTORY":Xt=[],ze.empty();break;case"REMOVE_CONTENT":var m=ze.find("#"+e.id);if(!m.length)break;m.prev(".msg-time").length&&!m.next(".msg").length&&m.prev(".msg-time").remove(),m.remove();break;case"CLOSE_DANMU":"undefined"!=typeof setBarrageStatus&&(setBarrageStatus(e.isClose),player&&player.setBarrageStatus(!e.isClose));break;case"FLOWERS":tn.push(e);break;case"LIKES":if(e.nick==Et)return;Kt.push(e);break;case"MOBILE_SHARE":cn&&(window.location.search?window.location.href=window.location.href+"&time="+(new Date).getTime():window.location.href=window.location.href+"?time="+(new Date).getTime());break;case"DEBUG":if(hasPlaybackVideo)cn?window.location.search?window.location.href=window.location.href+"&time="+(new Date).getTime():window.location.href=window.location.href+"?time="+(new Date).getTime():location.reload();else if(An){var v=e.isdebug?"debug":channelStream;polyvObject.switchStream(channelId,v)}break;case"S_QUESTION":if(e.user.userId!==Ct)break;"error"===e.status?Ft.addTip(e.message):Ft.addList([e],!0);break;case"T_ANSWER":if("error"===e.status)return;e.s_userId===Ct&&Ft.addList([e],!0);break;case"REDPAPER":M([e]);break;case"SET_NICK":var g=$(".setting-msg");if(cn&&(g=$(".active-set-name").find(".js-set-name-tip")),"error"===e.status){var w=e.message;(customTemplate||"en"===language)&&("您的昵称中含有违规词"==e.message?w="Please do not use inappropriate words in the name.":"昵称已存在"==e.message&&(w="The name already exists!")),g.html(w).fadeIn();var y=setTimeout(function(){g.fadeOut(function(){clearTimeout(y),y=null,$(this).html(""),Je.attr("disabled",!1),Aa.focus()})},2e3)}else{e.userId==Ct&&($.ajax({url:location.origin+"/watch/"+channelId+"/set-nickname?nickname="+encodeURI(e.nick),type:"get",cache:!1,dataType:"json"}).done(function(t){if("success"===t.status){g.html(customTemplate?"Success":i18nText.nickNameSetSuccess).fadeIn();var n=setTimeout(function(){g.fadeOut(function(){clearTimeout(n),n=null,$(this).html(""),Je.attr("disabled",!1),$("#cancel-setnick").trigger("click"),cn&&$(".js-talk-input-cover").remove()})},2e3);Et=e.nick,Dt=!0,null!==Ft&&(Ft.myInfo.userName=e.nick),player&&!hasPlaybackVideo&&(player.changeParam(Ct,e.nick),"nickname"===marqueeType&&"function"==typeof player.j2s_changeHorseMessage&&player.j2s_changeHorseMessage(e.nick)),sn&&sn.updateConfig({userInfo:{nick:Et,pic:Nt,userId:Ct}})}}).fail(function(e){g.html(e.status+":"+e.statusText).fadeIn();var t=setTimeout(function(){g.fadeOut(function(){clearTimeout(t),t=null,$(this).html(""),Je.attr("disabled",!1),Aa.focus()})},2e3)}),callInteraction&&callInteraction.setUserInfo({nick:Et}));var T=e.nick;Ct==e.userId&&(T+=customTemplate?"(me)":"("+i18nText.me+")");var k=an[e.userId];k&&Xe.children('li[data-socketid="'+k.uid+'"]').find(".talk-box").text(T)}break;case"GET_REDPAPER":if(!e.openId)return!1;if(e.openId==sendRedPackId&&e.openId!=e.getOpenId){var p=ze.children("li");if(p.length>=qt){var f=p.eq(0);f.remove()}ze.append('<li class="msg" style="text-align:center"><span style="color:#ff8c00">'+e.nickname+"</span> "+i18nText.rpGetYour+"</li>"),Wt=ze[0].scrollHeight-Qe.height()-Qe.scrollTop()<120,Wt?Qe.scrollTop(ze[0].scrollHeight):$(".new-msg").fadeIn()}if(e.getOpenId!=sendRedPackId||e.openId==e.getOpenId||!e.senderNick)return!1;if(!cn)return!1;var p=ze.children("li");if(p.length>=qt){var f=p.eq(0);f.remove()}ze.append('<li class="msg" style="text-align:center">'+i18nText.rpGetPart1+'<span style="color:#ff8c00">'+e.senderNick+"</span> "+i18nText.rpGetPart1+"</li>"),(Wt=ze[0].scrollHeight-Qe.height()-Qe.scrollTop()<120)&&Qe.scrollTop(ze[0].scrollHeight);break;case"CHATROOM_CONTROL":var x=e.type,I=e.value;"closeWelcome"==x&&(logoEnabled=I);break;case"SIGN_IN":Mn=!1,bt=e.data.checkinId;var S=parseInt(e.data.limitTime);$(".sign-message").html(e.data.message),$(".player-signed,.mobile-signed").show();var C=setInterval(function(){S>0?1==Mn?(clearInterval(C),$(".signed-time").text("00")):($(".signed-time").text(S),S--):($(".player-signed,.mobile-signed").hide(),$(".signed-time").text("00"),clearInterval(C))},1e3);$(".btn-signed").unbind("click").on("click",function(e){if(!Mn){var t=$(".btn-signed"),n={x1:t.offset().left,x2:t.offset().left+t.width(),y1:t.offset().top,y2:t.offset().top+t.height()},a=e.pageX>=n.x1&&e.pageX<=n.x2,i=e.pageY>=n.y1&&e.pageY<=n.y2;null!==e.pageX&&null!==e.pageY&&a&&i&&(clearInterval(C),$(".signed-time").text("00"),socket&&(socket.emit("message",JSON.stringify({EVENT:"TO_SIGN_IN",roomId:Lt,checkinId:bt,user:{userId:Ct,nick:Et}})),$(".player-signed,.mobile-signed").hide(),$(".signed-success").show(),setTimeout(function(){$(".signed-success").css({display:"none"})},1e3)))}});break;case"STOP_SIGN_IN":Mn=!0,$(".player-signed,.mobile-signed").hide();break;case"BULLETIN":Pe(e.content);break;case"REMOVE_BULLETIN":Pe();break;case"ADD_SHIELD":var _=e.data;_?_.userId==Ct?(zt=!0,Bt=!0):_.ip===Tt&&(zt=!0,Ut=!0):(e.value===Tt&&(Ut=!0),e.value==Ct&&(Bt=!0));break;case"REMOVE_SHIELD":var _=e.data;_?_.userId==Ct?(zt=!1,Bt=!1):_.ip===Tt&&(zt=!1,Ut=!1):(e.value===Tt&&(Ut=!1),e.value==Ct&&(Bt=!1));break;case"UNSHIELD":e.userIds.some(function(e){return e.userId==Ct})&&(Ut=Bt=!1);break;case"TOGGLE_GONGGAO":if(marqueeEnabled="Y"===e.marqueeEnabled,!marqueeEnabled){var E=$("#notice-marquee");E.length>0&&(E.marquee("destroy"),E.html(""),cn&&(E.parent("li").removeClass("marquee-show"),$(".gonggao-msg").hide()))}break;case"SET_MANAGER_INFO":var O=e.user;if(!O)break;var m=Xe.children('li[data-socketid="'+O.uid+'"]');m.length&&m.find(".talk-logo>img").attr("src",O.pic).end().find(".talk-box").attr("title",O.nick).html(O.nick).end().find(".user-actor").attr("title",O.nick).html(O.actor).end();break;case"LotteryStart":case"LotteryEnd":case"ON_LOTTERY":case"LotteryWinner":gn.onSocket(e.EVENT,e),s($(".lottery-modal"),++ut);break;case"CREATE_IMAGE_TEXT":window.plvTuwenLive&&(e.data.id=Number(e.data.id),plvTuwenLive.updateTotal(Number(e.data.total)),e.data.isEdit?plvTuwenLive.editMsg(e.data):plvTuwenLive.newMsg(e.data));break;case"DELETE_IMAGE_TEXT":window.plvTuwenLive&&(plvTuwenLive.updateTotal(Number(e.data.total)),e.data.id?plvTuwenLive.delMsg(Number(e.data.id)):plvTuwenLive.delAllMsgs());break;case"SET_TOP_IMAGE_TEXT":window.plvTuwenLive&&("Y"===e.data.top?plvTuwenLive.setSticky(e.data.content):plvTuwenLive.cancelSticky(Number(e.data.id)));break;case"SET_IMAGE_TEXT_MSG":window.plvTuwenLive&&plvTuwenLive.updateSetting(e.data);break;case"GET_TEST_QUESTION_CONTENT":if(cn)break;setTimeout(function(){s($("#js-answer-card"),++ut)},2e3);break;case"START_QUESTIONNAIRE":var L=cn?9e3:2e3;setTimeout(function(){s($(".live-questionnaire"),++ut)},L);break;case"O_TEACHER_INFO":yt=e.data.userId,callInteraction&&callInteraction.setTeacherId(yt);break;case"EXIT_WHEN_IS_MAIN":$("#socketTransmitTip").show(),cn&&alert("en"===language?"Chatroom occupied, video only.":"已关联其他房间，仅可观看直播内容")}}function K(e){return e.HTML5||e.flash}function Z(e){if(!chatEnable)return console.log(">>>全局设置-聊天室已关闭"),!1;if(At)return console.log(">>>频道设置-聊天室已关闭"),!1;if(!Dt)return console.log(">>>设置昵称"),Me(),!1;var t=Ue.val();console.log(">>>r2917---value:",t);var n,a,o=new Date;Rn=!0,$(".chat-container").addClass("testS"),e&&(t=e),t=t.substring(0,200),t=T(t);var s=t.match(/\s/g);if(""==t||s&&s.length==t.length)return void console.log(">>>空白内容不发送",t);if(null==Ve?n=0:(n=o.getTime()-Ve.getTime(),a=Math.floor(n/1e3)),null!=Ve&&a<1)return i(customTemplate?"Too many messages":i18nText.chatSpeakFast),Qe.scrollTop(ze[0].scrollHeight),$("#count").text(0),void console.log(">>>发言过快");if(console.log(">>>r2949---value:",t),t){Ue.val("").blur(),$('li[data-type="chat"]').removeClass("talk-input-line2"),rt.removeClass("chat-send-btn-show face-layer-show"),$("#count").text(0);if(M([{user:{nick:Et,pic:Nt,userId:Ct},time:(new Date).getTime(),content:t}]),console.log(">>>createSpeakList"),!Ut&&!Bt&&!zt){console.log(">>>当前用户未被禁言");var d={EVENT:"SPEAK",values:[t],roomId:Lt,channelId:channelId,accountId:accountId,sessionId:currentSessionId};replayHistoryMessage&&isReplay&&(d.isReplay=!0),socket?(console.log(">>>socket"),socket.emit("message",JSON.stringify(d))):(console.log(">>>socket 不存在"),i(customTemplate?"You are not allowed to send messages at the moment.":i18nText.chatUnSpeak),Qe.scrollTop(ze[0].scrollHeight))}var r=t.replace(/\n/g,"");if(r=T(r),r=b(r,2),canSendBarr&&"function"==typeof sendBarrage&&"vod"!==playbackOrigin)try{sendBarrage(r)}catch(e){console.log(e)}}Ve=new Date}function ee(){$(".submit-cash").css({position:"relative"}),cn?(180!=window.orientation&&0!=window.orientation||($(".mob-nav-list,.adv-block,"+$(".mob-nav-active").data("target")).show(),$(".main-section-wrap-container").show(),"chat"==$(".current").data("type")&&$("#chat-input-wrap").show(),Un=!1,$("body").removeClass("hengping"),setTimeout(function(){var e=.5625*document.body.clientWidth;$(".vr-wrap").height(e)},300)),90!=window.orientation&&-90!=window.orientation||($(".mob-nav-list,.adv-block,"+$(".mob-nav-active").data("target")).hide(),$(".main-section-wrap-container").hide(),"chat"==$(".current").data("type")&&$("#chat-input-wrap").hide(),Un=!0,$("body").addClass("hengping"))):$("#bottomMenusWrap").css("top",$("#mboxContent").height()+170)}function te(e,t){e.removeAttr("class"),"live"===t?(e.attr("class","txt-live-status live-status-living"),e.text(i18nText.watchLive)):"stop"===t?(e.attr("class","txt-live-status live-status-living"),e.text(i18nText.watchPause)):countOpen&&countTime>Date.now()/1e3&&!hasRecord&&!hasPlaybackVideo?(e.attr("class","txt-live-status live-status-waiting"),e.text(i18nText.watchWating)):(e.attr("class","txt-live-status live-status-nolive"),e.text(i18nText.watchNoLive))}function ne(){$.ajax({url:It+"/live/liveType/"+channelId,type:"GET",dataType:"text"}).done(function(e){!ct&&e&&e!==ftlMode&&($(".live-tip-box-wrap").show(),cn&&X5Full(!0))})}function ae(){var e=$("body").hasClass("stream-scale-4-3"),t=$("body").width()*(e?.75:.5625),n=$("video")[0].videoHeight/$("video")[0].videoWidth,a=isNaN(n)?0:(t-$("body").width()*n)/2;$("video")[0].style.objectPosition="0px "+(50+a)+"px"}function ie(){$.ajax({url:It+"/live_status/query",type:"get",dataType:"jsonp",data:{stream:channelStream}}).done(function(e){te($(".txt-live-status"),e),"live"===e?(callInteraction=J(),hasPlaybackVideo&&"N"===isDebug&&$(".live-tip-box-wrap").show()):st.removeClass("main-right-container-live")})}function oe(){$.ajax({url:It+"/live/channel-sessionid/query?channelId="+currentChannelId,type:"GET",success:function(e){channelSessionId=e,currentSessionId=e,gn.updateSessionId(e),callInteraction&&callInteraction.changeSessionId(channelSessionId),void 0!=player&&void 0!=player.changeSessionId&&player.changeSessionId(e)}})}function se(){$.ajax({url:It+"/live/live_status/query2?stream="+channelStream+"&stream2="+switchStream,type:"GET",cache:!1,data:null,processData:!1,contentType:!1}).done(function(e){var t=[];"string"==typeof e&&(t=e.split(","));var n=t[0].indexOf("live")>-1&&t[1].indexOf("live")>-1?"live":"end";Jn(n)})}function de(e,t){var n=!1;$.ajax({url:It+"/live/front/watch/video-has-passwd?videoPoolId="+e,type:"get",dataType:"json"}).done(function(e){e&&"success"==e.status&&"Y"==e.data&&(n=!0)}).always(function(){t(n)})}function re(e,t,n){if(!1===window.vodUserStatus)return void alert(window.i18nText.videoPlayFail);var a={width:"100%",height:"100%",vid:e,liveStreamName:channelStream,session_id:playerOptions.session_id||"",params:{param1:Ct||"guest",param2:Et||"guest"}};t&&(a.ts=t),n&&(a.sign=n),$(".player-box").html(""),player=polyvObject(".player-box").videoPlayer(a)}function ue(e){-1!=ln.indexOf("MSIE")&&(location.origin=vt+"//"+location.host),location.href=location.origin+location.pathname+"?liveType=ppt&videoId="+e}function ce(e){var t=$("#plvVideoList").find('[data-vid="'+e+'"]');if("ppt"===t.data("livetype")&&ue(t.attr("id")),ia)return ia=!1,player.j2s_pauseVideo(),void $(".video-playing").removeClass("video-playing");t.parent("li").addClass("video-playing")}function le(e){if("string"!=typeof e||!e.trim())return 0;var t=e.split(":");return 60*Number(t[0])*60+60*Number(t[1])+Number(t[2])}function pe(e,t){$.ajax({url:"/api/get-play-token",type:"get",dataType:"json",data:{vid:e}}).done(function(e){t(200===e.code&&e.data?e.data:{})}).fail(function(e){console.log(e)})}function fe(e){if(!e)return e;var t=window.location.protocol;return"https:"===t&&e&&-1===e.indexOf("https:")?e.replace("http:","https:"):"http:"===t&&e&&-1!==e.indexOf("https:")?e.replace("https:","http:"):e}function he(e){return e&&-1===e.indexOf("_s.")&&(e=e.replace(/(.*)\./,"$1_s.")),fe(e)}function me(){if("vod"!==playbackOrigin||window.isWatchBack)Kn&&(playerOptions.vodsrc=Kn),ea&&(playerOptions.videoId=ea),playerOptions.session_id=Zn||channelSessionId,window.isWatchBack&&(playerOptions.vodsrc=window.isRecordFile?window.watchBackUrl:he(window.watchBackUrl),playerOptions.banDanmuBtn=!0,playerOptions.session_id=window.watchBackSessionId),cn?(useVr||(playerOptions.isAutoChange=playerAutoChange,enableX5?playerOptions.x5=!isHuaWeiWeChat():playerOptions.useH5Page=!0),playerOptions.vodSrcDuration=le(ta),0===parseInt(availableTrial)||"undefined"!=typeof couldWatchTime&&couldWatchTime<=0||(player=polyvObject(".player-box").livePlayer(playerOptions))):isIeBroswer||"flash"===playerType?player=polyvObject(".player-main").livePlayer(playerOptions):player=polyvLivePlayer(playerOptions);else{if(!1===window.vodUserStatus)return void alert(window.i18nText.videoPlayFail);playerOptions.vid=ua[0].vid,1===ua[0].seed?pe(playerOptions.vid,function(e){cn?(playerOptions.ts=e.ts,playerOptions.sign=e.sign,player=polyvObject(".player-box").videoPlayer(playerOptions)):(playerOptions.playsafe=e.token,player=polyvPlayer(playerOptions))}):player=cn?polyvObject(".player-box").videoPlayer(playerOptions):polyvPlayer(playerOptions)}}function ve(){function e(e){if(e&&"number"==typeof e.pptDelayTime){var t=1e3*e.pptDelayTime;sn&&sn.updateConfig&&sn.updateConfig({delayTime:t}),En&&En.updateDelayTime(t)}}"record"===playbackOrigin||"playback"===playbackOrigin?(player.on("s2j_onStartPlay",function(){cn&&"playback"===playbackOrigin&&(player.j2s_pauseVideo(),player.j2s_resumeVideo())}),player.on("s2j_onOver",function(e){$("#plvVideoList").length?$e():isReplay&&replayHistoryMessage&&"undefined"!=typeof startTime&&"undefined"!=typeof endTime&&y(startTime,endTime)}),player.on("s2j_onPlay",function(e){if(ce(e.vid||ea),aa&&replayHistoryMessage&&isReplay&&Vt){var t=startTime+1e3*player.j2s_getCurrentTime();ze.html(""),y(t,endTime)}aa=!1}),player.on("s2j_onPause",function(){aa=!0,replayHistoryMessage&&w()}),player.on("s2j_onPptDelayTime",e)):"vod"===playbackOrigin?(window.s2j_onPlayStart=function(e){},window.s2j_onPlayOver=function(e){$("#plvVideoList").length&&$e(e)},window.s2j_onVideoPlay=function(e){if(na=e,$("#plvVideoList").length&&(cn&&(Pn=!0,fa&&(ln.indexOf("iPhone")>-1?player.j2s_seekVideo(ha):setTimeout(function(){player.j2s_seekVideo(ha)},500),fa=!1)),ce(e)),aa&&replayHistoryMessage&&isReplay&&Vt)var t=setTimeout(function(){clearTimeout(t),t=null;var e=player.j2s_getCurrentTime(),n=startTime+1e3*e;Wn=n,y(startTime,endTime)},1e3);aa=!1},window.s2j_onVideoPause=function(){aa=!0,replayHistoryMessage&&w()}):"live"===livestatus&&player.on("s2j_onPptDelayTime",e),oa=!0}function ge(e){var t=[];t.push('<span class="dots-prev js-dots-item" id="videoListPrevPage">&lt;</span>');for(var n=1;n<=e;n++){var a='<span id="pagination'+n+'" class="dots-item js-dots-item';1===n&&(a+=" dots-item-active"),a+='" data-page="'+n+'">'+n+"</span>",t.push(a)}t.push('<span class="dots-next js-dots-item" id="videoListNextPage">&gt;</span>'),$("#plvVideoPageNnmberList").html(t.join("")).on("click",".js-dots-item",function(){var e=$(this),t=e.data("page");e.hasClass("dots-prev")?t=--sa>0?sa:1:e.hasClass("dots-next")&&(t=++sa<=da?sa:da),sa=t,$(".dots-item-active").removeClass("dots-item-active"),$("#pagination"+t).addClass("dots-item-active"),ye(sa)})}function we(e){ia=!1;var t=e.contents,n=[];la=e.totalItems,da=Math.ceil(la/12),cn||$(".history-videos-list").hide();for(var a=0;a<t.length;a++){var i=t[a],o=i.channelSessionId,s=i.videoPoolId+"_"+i.videoPoolId.slice(0,1);0===a&&(Kn=i.fileUrl,Zn=o,ea=s,ta=i.duration),ua.push({vid:s,seed:i.seed}),ca.push(o);var d=i.title,r=i.firstImage,u="//livestatic.videocc.net/assets/wimages/videodefault.png";r&&(u=-1!==r.indexOf("http")||-1!==r.indexOf("doc.polyv.net")?r:"//img.videocc.net/uimage/"+r.slice(0,1)+"/"+r);var c='<li title="'+d+'" data-realindex="'+ra+'" data-index="'+a+'"><div id="'+i.videoId+'" class="video-cover-img" data-startTime="'+i.startTime+'" data-createdTime="'+i.createdTime+'" data-duration="'+i.duration+'" data-url="'+i.fileUrl+'" data-vid="'+s+'" data-seed="'+i.seed+'" data-sessionId="'+o;c+='" data-livetype="'+i.liveType,c+='"><img src="'+u+'" alt="'+d+'" /><div class="video-mask"></div></div><div><h1 class="video-title">'+d+'</h1><h2 class="video-during">直播时长：<span>'+i.duration+"</span></h2></div></li>",n.push(c),ra++}if(cn)return void $("#plvVideoList").append(n.join(""));var l=$("<ul />").addClass("history-videos-list clearfix").attr("id","history-videos-list-"+sa).html(n.join(""));0===$("#history-videos-list-"+(sa-1)).length?$("#plvVideoList").append(l):l.insertAfter($("#history-videos-list-"+(sa-1))),1==sa&&ge(da)}function ye(e){if(e=e||1,$("#history-videos-list-"+e).length)return sa=e,$(".history-videos-list").hide(),void $("#history-videos-list-"+e).show();$.ajax({url:It+"/live/v2/channel/recordFile/"+channelId+"/jsonp/playback-list?page="+e,type:"get",dataType:"jsonp"}).done(function(e){if(e&&e.totalItems)if($("#plvVideoList").length)we(e);else{var t=e.contents[0];Kn=t.fileUrl,Zn=t.channelSessionId,ta=t.duration,ua.push({vid:t.videoPoolId+"_"+t.videoPoolId.slice(0,1),seed:t.seed}),ca.push(t.channelSessionId)}}).always(function(){pa=!0,$("#backListLoading").remove(),player||me()})}function $e(e){na=e;var t=$(".video-playing"),n=t.data("realindex")+1;n>=la&&(ia=!0,n=0,$("#pagination1").trigger("click"));var a=$('li[data-realindex="'+n+'"]');if(n&&n%12==0)if($("#videoListNextPage").trigger("click"),a.length)a.find(".video-cover-img").trigger("click");else var i=setInterval(function(){$('li[data-realindex="'+n+'"]').length&&(clearInterval(i),i=null,$('li[data-realindex="'+n+'"]').find(".video-cover-img").trigger("click"))},500);else a.find(".video-cover-img").trigger("click")}function be(e){e.hasClass("video-playing")||($(".video-playing").removeClass("video-playing"),e.addClass("video-playing"))}function Te(e,t){var n,a,i=e.split(":"),o=1e3*(parseInt(60*i[0]*60)+parseInt(60*i[1])+parseInt(i[2])),s=t;if(s&&"undefined"!=s){ze.html(""),s=s.toString();var d=s.substring(0,4),r=s.substring(4,6),u=s.substring(6,8),c=s.substring(8,10),l=s.substring(10,12),p=s.substring(12,14),f=d+"/"+r+"/"+u+" "+c+":"+l+":"+p;n=new Date(f).getTime(),a=n+o+3e5,startTime=n,endTime=a,cn&&(Wn=startTime),y(n,a),Vt=!0,Gt=!1}else startTime=0,endTime=0,Gt||(w(),ze.html(""),g(),Gt=!0),Vt=!1}function ke(e){be(e.parent("li"));var t=e.data("vid");if(ea=t,replayHistoryMessage){Te(e.data("duration"),e.data("starttime"))}if("vod"===playbackOrigin)if(na===t)player.j2s_resumeVideo();else{na=t;var n=e.data("seed");1===n?pe(t,function(e){cn?de(t.split("_")[0],function(n){n?re(t,e.ts,e.sign):player.changeVid({vid:t,ts:e.ts,sign:e.sign})}):player.changeVid({vid:t,autoplay:!0,
playsafe:e.token})}):cn?de(t.split("_")[0],function(e){e?re(t):player.changeVid(t)}):player.changeVid({vid:t,autoplay:!0})}else if("playback"===playbackOrigin){var a={url:e.data("url"),duration:le(e.data("duration")),videoId:t,statistics:{sessionId:e.data("sessionid")}};cn&&(a.autoplay=!0),player.changeVod(a)}}function xe(e){if(yn)WeixinJSBridge.invoke("imagePreview",{current:e,urls:on});else{$(".img-msg-fullpage").remove(),$("body").append('<div class="img-msg-fullpage"><img src="'+e+'"/></div>');var t=!1;$(".img-msg-fullpage").on("touchstart",function(){t=!1}).on("touchmove",function(){t=!0}).on(mt,function(){if(!t)return $(this).remove(),!1})}}function Ie(){fa=!0,$("body").toggleClass("audio-mode-show"),cn&&!useVr&&!audioMode&&polyvObject.isSupportSamePlayer()&&(player.switchMMode(),player.j2s_resumeVideo()),$("#change-play-mode").toggleClass("audio-mode video-mode").toggleData("status","video","audio").children("span").toggleText(customTemplate?"Audio mode":i18nText.audioPlayer,customTemplate?"Video mode":i18nText.videoPlayer),isReplay&&player&&ma&&(ha=player.j2s_getCurrentTime(),player.switchMMode(),player.j2s_resumeVideo())}function Se(e){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},function(e){"get_brand_wcpay_request：ok"==e.err_msg&&($("#alert-custom").show(),$("#getSuccess").text(i18nText.paySuccess))})}function Ce(e){var e=Math.round(100*parseFloat(e))/100,t=e.toString().split(".");return 1==t.length?e=e.toString()+".00":t.length>1?(t[1].length<2&&(e=e.toString()+"0"),e):void 0}function _e(e){var t=$("#open-redpaper").attr("rid"),n="/watch/redpack/"+t+"/receive-list",a="/weixin-withdraw/"+channelId+"/user";$.post(n,{redpackId:t},function(e){if("success"==e.status){$("#redpaper-detail-wrap").fadeIn(),X5Full(!0),$(".receive-list li").remove();var t=e.data.sendTs,n=e.data.ts,a=(n-t)/1e3,i=Math.floor(a/60),o=(a%60/100).toFixed(2).slice(-2);"0"!=n?$(".total-time").text(","+i+i18nText.rpMinutes+o+i18nText.rpSeconds+i18nText.rpGetOver2):$(".total-time").text(""),"null"!=e.data.amount&&"0"!=e.data.amount?($("#yuan").show(),$("#getPaperAmount").text(e.data.amount),$("#no-redpaper-wrap").hide()):($("#yuan").hide(),$("#getPaperAmount").text(i18nText.rpGetOver),$("#no-redpaper-wrap").hide());var s=(e.data.bestLuckId,e.data.receiveList),d=s.length,r=e.data.maxAmount;$("#redpaper-mount").text(i18nText.rpGeted+d+"/"+ba);for(var u=0;u<d;u++){var c=s[u],l=Ce(c.amount),p='<li class="li-cash"><p class="p-cash"><span class="left">'+c.nickname+'</span><span class="price currPaper">¥ '+l+'</span><br/><span class="left time-paper">'+Ne(c.createdTime)+"</span>";r&&r==l&&ka&&(p+='<span class="price bestLuck"><img class="best-luck" src="//livestatic.videocc.net/assets/wimages/best-luck.png" alt="">'+i18nText.rpGetLuckiest+"</span>"),p+='</p><img  class="get-redpaper-hosts-pic userPic" src="'+c.avatar+'"></li>',$(".receive-list").append(p)}}else $("#alert-custom").show(),$("#getSuccess").text("ERROR6: "+e.message)},"json").fail(function(){}),$.post(a,function(e){if("success"==e.status){var t=e.data.balance;t<=1?$("#total-mount,#no-total-mount").hide():($("#all-mount,#no-all-mount").text(t),$("#total-mount,#no-total-mount").show())}else"user_not_found"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetNoUser)):"blank_openid"==e.message&&($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetNoUserId))},"json")}function Ee(){var e=window.navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)||"_sq_"==e.match(/_SQ_/i)}function Oe(){var e=$("#total-amount"),t=/^\+?[1-9]\d*$/,n=$("#number");if(n.val().constructor===String){var a=n.val().match(t);if(null==a&&""!=n.val())return n.val(""),!1}if(e.val().constructor===String){var a=e.val().match(t);if(null==a&&""!=e.val())return e.val(""),$(".money-text").text("0.00"),!1}}function Le(){var e="/watch/redpack/"+channelId+"/statistics";$.post(e,function(e){if("success"==e.status){if($(".my-redpaper-wrap").show(),X5Full(!0),$(".Redpaper,.Cash").css({"border-bottom":"none"}),$(".statistics li").remove(),$(".totalReceive").text(e.data.totalReceive),$(".totalWithdraw").text(e.data.totalWithdraw),$(".totalAmount").text(e.data.totalAmount),$("#cashLimit").val(e.data.totalAmount),void 0!==e.data.currReceiveLog){var t=Ce(e.data.currReceiveLog.amount);$(".statistics").append('<li class="li-cash"><p class="p-cash"><span class="left">'+i18nText.rpGet+'</span><span class="price withdraw">+ ¥ '+t+'</span><br/><span class="left time-paper">'+Ne(e.data.currReceiveLog.createdTime)+'</span></p><img src="//livestatic.videocc.net/assets/wimages/redpaper.png" alt=""></li>')}if(void 0!==e.data.currWithdrawLog){var n=Ce(e.data.currWithdrawLog.amount);$(".statistics").append('<li class="li-cash"><p class="p-cash"><span class="left">'+i18nText.rpGetCash+'</span><span class="price currPaper">- ¥ '+n+'</span><br/><span class="left time-paper">'+Ne(e.data.currWithdrawLog.createdTime)+'</span></p><img src="//livestatic.videocc.net/assets/wimages/get-cash.png" alt=""></li>')}}else"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):"user_not_found"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetNoUser)):($("#alert-custom").show(),$("#getSuccess").text("ERROR7: "+e.message))},"json").fail(function(){})}function Ne(e){return new Date(parseInt(e)).toLocaleString().replace(/:\d{1,2}$/," ").replace("GMT+8"," ")}function Me(){$("#set-nick-modal").show()}function Ae(e){return new RegExp(/[(\~)(\!)(\@)(\#)(\$)(\%)(\^)(\&)(\*)(\()(\))(\-)(\_)(\+)(\=)(\[)(\])(\{)(\})(\|)(\\)(\;)(\:)(\')(\")(\,)(\.)(\/)(\<)(\>)(\?)(\)]+/).test(e)}function je(e,t,n,a,i){n.html(e).fadeIn(),ja=setTimeout(function(){clearTimeout(ja),ja=null,n.fadeOut(function(){$(this).html(""),a.attr("disabled",!1)})},1e3*t),i.focus()}function Re(e,t){clearTimeout(ja),ja=null;var n=$(e);n.attr("disabled",!0);var a=$(t),i=$(".setting-msg");cn&&(i=a.parents(".js-talk-input-cover").find(".js-set-name-tip"));var o=a.val();o=o.replace(/\n/g,"");var s=o.length;if(o=T(o),s!==o.length)return i.html(customTemplate?"An illegal character was encountered in the name":i18nText.illegalName).fadeIn(),ja=setTimeout(function(){clearTimeout(ja),ja=null,i.fadeOut(function(){$(this).html(""),n.attr("disabled",!1)})},2e3),void a.focus();var d=o.match(/\s/g);return!o||d&&d.length===o.length?(i.html(customTemplate?"Name can't be left blank":i18nText.emptyName).fadeIn(),ja=setTimeout(function(){clearTimeout(ja),ja=null,i.fadeOut(function(){$(this).html(""),n.attr("disabled",!1)})},2e3),void a.focus()):Ae(o)?void je(customTemplate?"An illegal character was encountered in the name":i18nText.illegalName,2,i,n,a):o.length>20?(i.html(customTemplate?"Name can't be over 20 characters":i18nText.longName).fadeIn(),ja=setTimeout(function(){clearTimeout(ja),ja=null,i.fadeOut(function(){$(this).html(""),n.attr("disabled",!1)})},2e3),void a.focus()):void(o&&socket&&socket.emit("message",JSON.stringify({EVENT:"SET_NICK",roomId:Lt,channelId:channelId,userId:Ct,nick:o})))}function qe(e){!1===e?$("#announcementWrap").hide():$("#announcementWrap").show()}function Pe(e){$("#announcementText").html(e||i18nText.noNotice),e?qe():qe(!1)}function We(e,t){t||(t=3e3);var n=document.querySelector("#msgTip");"msgShow"!==n.getAttribute("class")&&n.setAttribute("class","msgShow"),n.innerHTML=e,qa=setTimeout(function(){n.removeAttribute("class"),n.innerHTML="",clearTimeout(qa),qa=null},t)}function He(e){var t=e.id,n=e.imgSrc,a=e.status,i=document.querySelector("#"+t);if("forbid"===a&&(i.setAttribute("style","display:none"),$(i).parents("li").eq(0).attr("style","height: 105px;")),i.setAttribute("src",n||Ha),"upLoadingFail"===a||"forbid"===a){We("上传失败");var o=$(i).parents(".talk-txt")[0],s=o.getAttribute("class"),d="upLoadingFail"===a?"uploading-fail":"uploading-forbid";o.setAttribute("class",s+" "+d)}}function De(e){if("start"===e.status&&(e.uploadImgUrl=Ha,Fe(e)),!Ut&&!Bt&&"upLoadingSuccess"===e.status){e.msgSource="chatImg";var t={EVENT:"CHAT_IMG",roomId:Lt,values:[e],subsidiaryRoom:sibRooms,accountId:accountId,channelId:channelId,sessionId:currentSessionId};socket?socket.emit("message",JSON.stringify(t)):(i(i18nText.chatUnSpeak),ze.scrollTop(ze[0].scrollHeight),Qe.scrollTop(ze.height()))}}function Fe(e){M([{user:{nick:Et,pic:Nt,userId:Ct,userType:"teacher"},time:(new Date).getTime(),content:e,msgSource:"chatImg"}])}var Ge="userinfo"in window?window.userinfo:{},Ve=null,Ue=$("#chatipt"),Be=$("#send"),ze=$("#talkList"),Qe=$("#talk"),Xe=$("#userList"),Je=$("#sure-setnick"),Ye=$("#usercount"),Ke=$("#pageView"),Ze=$(".desc-watch-num"),et=$("#usersLookMore"),tt=$("#likenum"),nt=$("#likes-user"),at=$("#welcome-user"),it=$(".welcome-single-msg"),ot=$("#welcome-multi-user"),st=$(".mbox-rwrp"),dt=$("#btn-vr"),rt=($("#raise-hands"),$("body")),ut=1e3,ct=!1,lt=$("#quizNotice"),pt=0,ft=0,ht="end",mt="click",vt="http:"===location.protocol?"http:":"https:",gt=location.search,wt="WebSocket"in window||"MozWebSocket"in window;wt||"chat.polyv.net"!==chatDomain||(chatDomain="polling-chat.polyv.net"),-1!==gt.indexOf("debugBeta=L")&&(chatDomain="127.0.0.1:8012",chatApiDomain="127.0.0.1:8888");var yt,$t,bt,Tt,kt=vt+"//"+chatDomain,xt=vt+"//"+chatApiDomain,It=vt+"//api.polyv.net",St=-1!==gt.indexOf("pta=1"),Ct=Ge.userId,_t=Ge.micUserId,Et=Ge.userName,Ot=Ge.marqueeName,Lt=Ge.roomName,Nt=Ge.pic,Mt=Ge.userType?Ge.userType:"student",At=!1,jt=Math.pow(2,32),Rt=(_t%jt).toString(),qt=200,Pt=100,Wt=!0,Ht=new RegExp((customTemplate&&"观众"==nicknamePrefix?"Viewer":nicknamePrefix)+"/[0-9]+$"),Dt=!Ht.test(Et),Ft=null,Gt=!1,Vt=!1,Ut=!1,Bt=!1,zt=!1,Qt=null,Xt=[],Jt=[],Yt=[],Kt=[],Zt=[],en=[],tn=[],nn={},an={},on=[],sn=null,dn=10,rn=!0,un=!0;"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){for(var n=0,a=this.length;n<a;n++)"function"==typeof e&&Object.prototype.hasOwnProperty.call(this,n)&&e.call(t,this[n],n,this)}),"function"!=typeof Array.prototype.some&&(Array.prototype.some=function(e,t){var n=!1;if("function"==typeof e)for(var a=0,i=this.length;a<i&&!0!==n;a++)n=!!e.call(t,this[a],a,this);return n}),"function"!=typeof Date.now&&(Date.now=function(){return(new Date).valueOf()}),"function"!=typeof String.trim&&(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")});var cn=function(){var e=navigator.userAgent||navigator.vendor||window.opera,t=!1;return(/(android|bb\d+|meego).+mobile|Android|ios|IOS|iOS|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|Pad|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}();cn&&(mt="touchend");var ln=navigator.userAgent,pn=!1;cn&&-1!==ln.indexOf("Android")&&(pn=!0);var fn=cn&&-1!==ln.toUpperCase().indexOf("IPHONE");a.prototype.init=function(){this.getList()},a.prototype.getList=function(){if(this.requestEnd&&this.hasMoreContent){var e=this;e.requestEnd=!1,n(this.chatApiDomain,{roomId:this.roomId,page:++this.page,sessionId:this.sessionId}).done(function(t){if(200===t.code){t=t.data;var n=t.data;if(e.hasMoreContent=n&&n.length>=10,!n||n.length<=0)return void(1===e.page&&$("#talkList").append('<li style="text-align: center;">聊天室空空如也~</li>'));e.page=t.curPage;var a=n.slice(0,10);1!==e.page?M(a,!0):M(a.reverse())}}).always(function(){e.requestEnd=!0})}};var hn=new a({chatApiDomain:xt,roomId:Lt,sessionId:window.watchBackSessionId});window.plvEmotion||(window.plvEmotion={genDOMList:function(){},parseEmotions:function(){}}),$("#facemain").html(window.plvEmotion.genDOMList()),Dt&&$(".js-talk-input-cover").remove();var mn=new Translator(cn?$("#talk").parent():".talk-wrap"),vn=!1;ze.on("click",".btn-translate",function(){if(!vn){var e=$(this);if(!e.data("translated")){vn=!0;var t=e.parent(),n=t.text();mn.translate("/watch/"+Lt+"/translate",n).then(function(n){if(vn=!1,200===n.code){var a=n.data[0];$('<div class="web-translation-txt"><p>'+a+"</p></div>").insertAfter(t),e.data("translated",!0)}else mn.showError()},function(e){console.log(e),vn=!1,mn.showError()})}}});var gn=new Lottery({chatApiHost:xt,apiHost:It,userId:Ct,channelId:window.currentChannelId,sessionId:currentSessionId,appendSystemInfo:i,i18nText:window.i18nText,language:window.language,ismobile:cn,isChinese:"zh_CN"===window.language});gn.init();var wn=!1;ln.match(/Android|OS|Firefox/i)&&(wn=!0);var yn=cn&&-1!==ln.indexOf("MicroMessenger");(function(){return!!fn&&[{devicePixelRatio:3,width:414,height:896},{devicePixelRatio:2,width:414,height:896},{devicePixelRatio:3,width:375,height:812}].some(function(e){return e.devicePixelRatio===window.devicePixelRatio&&e.width===window.screen.width&&e.height===window.screen.height})})()&&yn&&$(".reward-wrap").addClass("reward-wrap-XSeries");var $n=null;cn&&isCcb&&o();var bn=new window.PlvRewardAnimate({container:".talk-chatroom-wrap",maxShowNumber:cn?2:3});$(".js-good-number-select-list").on(mt,"span",function(){$(".good-number-active").removeClass("good-number-active"),$(this).addClass("good-number-active")});var Tn=0;$("body").ajaxError(function(e,t,n,a){console.log(e),console.log(t),console.log(n),console.log(a)});var kn=[],xn=(new Date).toLocaleDateString(),In=0,Sn=0,Cn=!1;if((cn&&(chatOnlineNumberEnable||isCcb)||!cn&&(chatOnlineNumberEnable||chaterListVisible))&&q(),"hasQuiz"in window&&hasQuiz&&(Ft=new F(cn,xt,Ge),Ft.init()),"Y"===groupEnabled){new G(switchChannel).init()}Be.on(mt,function(){console.log(">>>>click send btn"),Z()});$("#chatInputWrap");Ue.on("keypress",function(e){var t=e.keyCode||e.which;if(!cn&&13===t)return e.shiftKey?Ue.val(Ue.val()+"\n"):Z(),$(this).focus(),!1}),U($(".talk-ipt-main"),"#count",200),U($(".textarea-input"),"",200),U($(".sendMessage"),".curCount",200),U($("#sendMsgWrap_aq"),"",200),$("#faceicon").on(mt,function(){cn?rt.toggleClass("face-layer-show").removeClass("more-layer-show"):Dt||Me(),Ue.blur()}),$(".quiz-tab").on(mt,function(){if(!Dt&&!cn)return Me(),!1;lt.hide()}),$("#sendImgForChat").on(mt,function(){if(!Dt&&!cn)return Me(),!1});var _n={x:0,y:0};$("#facemain").on("touchstart","li",function(){_n.x=event.changedTouches[0].pageX,_n.y=event.changedTouches[0].pageY}),$("#facemain").on(mt,"li",function(){if(cn){var e=event.changedTouches[0],t=e.pageX,n=e.pageY;if(Math.abs(t-_n.x)>5||Math.abs(n-_n.y)>5)return _n.x=0,void(_n.y=0)}var a=$(this).children(".plv-emotion-panel__item__ico"),i=a.attr("data-title");"delContent"===i?z():B(i),Ue.trigger("input")});var En,On=function(){return document.documentMode||+(navigator.userAgent.match(/MSIE (\d+)/)&&RegExp.$1)},Ln=[2e3,3e3,4e3,5e3],Nn=$(cn?".main-section-wrap":".player-layer"),Mn=!1,An=!1,jn=!1;window.isWatchBack||(!function(){Q();var e={};if(!chatToken)return void console.info("缺少token");chatToken&&!St&&(e.version="2.0",e.token=chatToken),socket=io(kt,{query:e,transports:[wt?"websocket":"polling"],reconnectionDelay:Ln[Math.floor(4*Math.random())],randomizationFactor:Math.random()}),socket.on("connect",function(){$("#socketUnline").hide();var e="";userinfo.actor&&(e={actor:userinfo.actor,bgColor:userinfo.actorBgColor,fColor:userinfo.actorFColor}),socket.emit("message",JSON.stringify({EVENT:"LOGIN",values:[Et,Nt,Ct],channelId:channelId,roomId:Lt,sibRooms:sibRooms,type:Mt,authorization:e}),function(e){e=e.toString(),"2"===e[0]&&(jn=!0),"0"===e[4]&&(zt=!0),window.callInteraction&&window.callInteraction.videoChatToken&&socket.emit("reJoinMic",window.callInteraction.videoChatToken)}),callInteraction=J(),sn||(sn=new InteractiveApp({socket:socket,shouldInitAnswer:!0,userInfo:{nick:Et,pic:Nt,userId:Ct},channelInfo:{channelId:channelId},locale:window.language,mobQaEl:"#interactiveAppQa"}),sn.init()),En||(En=new Questionnaire({el:Nn,layoutClass:"live-questionnaire-mobile",socket:socket,isMobile:cn,roomId:Lt,nick:Et,userId:Ct,startCallback:function(){Nn.addClass("answer-show")},endCallback:function(){Nn.removeClass("answer-show")}})),console.log("socket CONNECT"),window.plvTuwenLive&&window.tuwenReconnect()}),socket.on("disconnect",function(){console.log("disconnect")}),socket.on("message",function(e){var t=JSON.parse(e);if(t&&t.EVENT)switch(t.EVENT){case"MESSAGES":case"SPEAKS":if(!t.data)break;for(var n=0;n<t.data.length;n++)Y(t.data[n]);break;default:Y(t)}}),socket.on("error",function(e){console.log(e)})}(),setTimeout(function(){jn||ct||!$("#socketTransmitTip").is(":hidden")||$("#socketUnline").show()},3e4)),"record"===playbackOrigin||streamStatus||window.isWatchBack?me():ye(),window.s2j_onInitOver=function(){if(ct)return void("function"==typeof player.destroy?player.destroy():$(".player-box,.player-main").remove());An=!0,cn&&("undefined"!=typeof couldWatchTime&&couldWatchTime<0&&availableTrial>=0&&$(".player-box").remove(),Dt&&player&&player.changeParam&&player.changeParam(Ct,Et),"undefined"!=typeof warmUpType&&"image"===warmUpType&&$(".pl_noliveWrap>div").eq(1).length&&$(".pl_noliveWrap>div").eq(1).remove()),"vod"!==playbackOrigin&&vid&&($('[data-vid="'+vid+'"]').trigger("click"),vid=null),ve()},window.s2j_onInterfaceInitOver=function(){An=!0,Dt&&"vod"!==playbackOrigin&&(player&&player.changeParam&&!K(player)&&player.changeParam(Ct,Ot),K(player)&&player.changeStatistics(currentSessionId,Ct,Ot),"nickname"===marqueeType&&player.j2s_changeHorseMessage(Ot))},window.s2j_requestMarqueeAPI=function(){return!0};var Rn=!1;window.s2j_broadcastBarrageMsg=function(e){Z(e.substring(0,100))},window.s2j_getNickname=function(){return Et},$("#coderate-submit-btn").on("click",function(){var e=$(this);if(player){var t=e.data("value");t!=defaultCodeRate&&(player.j2s_changeMultirate(e.data("value")),defaultCodeRate=t),$("#coderate-list").children(".option-selected").removeClass("option-selected"),e.attr("disabled",!0),$("#btn-coderate").text(e.data("text")),$("#coderate-wrap").find(".icon-close").trigger("touchend")}}),$("#watchpattern-submit-btn").on("click",function(){var e=$(this);e.data("value")==switchType?switchChannel&&window.open("//live.polyv.cn/watch/"+switchChannel,"_self"):($("#watchpattern-list").children(".option-selected").removeClass("option-selected"),e.attr("disabled",!0),$("#watchpattern-wrap").find(".icon-close").trigger("touchend"))});var qn=0,Pn=!1,Wn=0;replayHistoryMessage?"undefined"!=typeof isReplay&&isReplay?(hasPlaybackVideo||"undefined"==typeof startTime||"undefined"==typeof endTime||(Vt=!0,y(startTime,endTime)),window.s2j_onSeek=function(e){Pn=!0,qn++;var t=startTime+1e3*e;Wn=t,startTime&&endTime&&y(startTime,endTime)},window.onseek=function(e,t){Pn=!0,qn++;var n=startTime+1e3*t;Wn=n,startTime&&endTime&&y(startTime,endTime)}):g():window.isWatchBack?hn.init():g();var Hn=2;et.on("click",function(){q(Hn),Hn+=1});var Dn=0,Fn=0,Gn=parseInt(tt.data("likenum"));$("#like").on(mt,function(){var e=(new Date).getTime();e-Dn>=200&&(Fn++,tt.html(f(++Gn)).data("likenum",Gn),h(Et)),Dn=e}),setInterval(function(){if(Fn){$.ajax({url:"/watch/"+channelId+"/like?times="+Fn,type:"GET",cache:!1,data:null,processData:!1,contentType:!1}).done(function(e){if("success"==e.status){var t=e.data;t>Gn&&tt.html(f(t)).data("likenum",t)}}).fail(function(){});var e=JSON.stringify({EVENT:"LIKES",roomId:Lt,nick:Et,count:Fn,userId:Ct,sessionId:currentSessionId});socket&&socket.emit("message",e),Fn=0}},5e3),setInterval(function(){W()},window.showCurViewer?3e3:1e4);var Vn=!1;$("#gift-flower").on(mt,function(){var e=$(this);if(e.attr("disabled"))return!1;Vn=!0;var t=JSON.stringify({EVENT:"FLOWERS",roomId:Lt,nick:Et,uimg:Nt});socket&&socket.emit("message",t),e.text("60s").attr("disabled",!0),cn?($(".reward-wrap").hide(),$("#amount").val(""),$("#good_id").val(""),$(".good-selected").removeClass("good-selected"),$("#good-reward-btn").show(),e.hide(),cn&&X5Full()):e.addClass("flower-timer").parents(".reward-modal").hide();var n=60,a=setInterval(function(){n--,n<=0?(cn?e.text(i18nText.rewardConfirm):e.hasClass("icon-flower")?e.text("").removeClass("flower-timer"):e.text(i18nText.rewardGive),e.attr("disabled",!1),clearInterval(a),a=null):e.text(n+"s")},1e3);return!1}),$("#only-teacher").click(function(){onlyTeacher=!onlyTeacher,N()});var Un=!1;window.addEventListener("onorientationchange"in window?"orientationchange":"resize",ee,!1),ee(),fn&&yn&&function(){var e=!1;window.addEventListener("pageshow",function(){e&&window.location.reload()}),window.addEventListener("pagehide",function(){e=!0})}(),$(".btn-reload").on(mt,function(){return location.reload(!0),!1});var Bn=0,zn=0,Qn=!1;window.s2j_onApiStatus=function(e){if(!window.isWatchBack){var t=$(".txt-live-status");"playback"!==playbackOrigin&&(Qn=!0),streamStatus="live"===e,te(t,e),"end"==e?(zn=0,Bn++,st.removeClass("main-right-container-live"),Bn>=2&&(window.isRealEnd=!0),2===Bn&&$("body").hasClass("x5-full")&&ae()):(window.isRealEnd=!1,Bn=0,zn++,"live"==e&&"N"===isDebug&&(hasPlaybackVideo?($(".live-tip-box-wrap").show(),cn&&X5Full(!0)):(isReplay=!1,replayHistoryMessage&&w(),$("#live-int-countdown,#player-countdown,#fl-countdown").css({display:"none"}),"end"!=livestatus||ga||ne()),ht!==e&&oe(),2===zn&&$("body").hasClass("x5-full")&&ae())),livestatus=e,ht=e,callInteraction=J()}};var Xn=window.isWatchBack?null:setTimeout(function(){Qn||setInterval(ie,6e3),clearTimeout(Xn),Xn=null},6e3);window.s2j_onChangeVodVideoSid=function(e){e&&e.length>0&&void 0!=player&&void 0!=player.changeSessionId&&player.changeSessionId(e)};var Jn=function(e){V(e)},Yn=null;"Y"===groupEnabled&&(se(),function(){var e=function e(){se(),clearTimeout(Yn),Yn=null,Yn=setTimeout(e,2e4)};Yn=setTimeout(e,2e4)}());var Kn,Zn,ea,ta=0;$(".not-install-flash .btn-html").on("click",function(){$(".not-install-flash").hide(),playerOptions.flash=!1,playerOptions.forceH5=!0,me(),$(".player-switch .switch-icon").removeClass("html-player").addClass("flash-player"),$(".player-content").text(i18nText.switchFlash),window.localStorage.playerType="html"});var na,aa=!1,ia=!1,oa=!1,sa=1,da=1,ra=0,ua=[],ca=[],la=0,pa=!0;cn&&$("#plvVideoList").length&&$("#historyVideosListTab").scroll(function(){var e=$(this);pa&&sa<da&&e.scrollTop()+e.height()>=e[0].scrollHeight&&(pa=!1,e.append('<div class="back-list-loading" id="backListLoading"></div>'),ye(++sa))}),$("#plvVideoList").on("click",".video-cover-img",function(){$(this).parent("li").hasClass("video-playing")||ke($(this))}),ze.on(mt,".img-msg",function(){xe($(this).attr("src"))}),window.s2j_onPlayerInitOver=function(){if(ct)return void("function"==typeof player.destroy?player.destroy():$(".player-box,.player-main").remove());vid&&"flash"!==playerType&&($('[data-vid="'+vid+'"]').trigger("click"),vid=null),cn&&!1===oa?ve():fa&&(player.switchMMode(),player.j2s_resumeVideo(),fa=!1),ma=!0},window.onmeta=function(){vid&&($('[data-vid="'+vid+'"]').trigger("click"),vid=null)};var fa=!1,ha=0,ma=!1;$("#change-play-mode").on("touchend",function(){Ie()}),$("body").on("toggleAudioVideoMode",function(){Ie()}),window.s2j_onAudioBtnClick=function(){Ie()},$("#connect-mp-mask-close").on("click",function(){$(".connect-mp-mask").hide()});var va;Qe.scroll(function(){var e=Qe.scrollTop();0!==e?(Wt=ze[0].scrollHeight-Qe.height()-e<120)&&$(".new-msg").hide():e!==va&&(window.isWatchBack?hn.getList():(g(dn),dn+=10)),va=e});var ga=!1;window.addEventListener&&window.addEventListener("message",function(e){var t=e.data;if(t&&t.message){if("wangxiaoyun"==t.message){ga=!0;var n=JSON.parse(t.arguments);$(".container").addClass("defaultHide-container"),n.chatHide&&$(".container").addClass("chatHide-container"),n.showTeacherHide&&(cn?$(".teacher-only").parent("li").hide():$(".teacher-only").hide()),n.hideLinkMic&&$(".container").addClass("hideLinkMic-container")}if("postParams"==t.message&&player.changeParam(t.param1,t.param2,t.param3,t.param4),"changeTboxPosition"==t.message){var a=$(".mbox").height();$(".tbox").css({top:a+60}),$(".wrap").addClass("changeTboxPosition")}}},!1);var wa=null;!function(){var e=function e(){socket&&$t&&socket.emit("message",JSON.stringify({EVENT:"HEARTBEAT",uid:$t})),clearTimeout(wa),wa=null,wa=setTimeout(e,18e5)};window.testh=e,wa=setTimeout(e,18e5)}(),$(".new-msg").on(mt,function(){Qe.scrollTop(ze[0].scrollHeight),$(this).fadeOut()}),$(".paper-amount").keyup(function(){$(".money-text").text($(".paper-amount").val())}),$(".btn-redpaper,#check-other-redpaper,#get-cash,#getCash,#yes,#cancel,#total,#total-mount,#no-total-mount,#historyGetCash,#historyGetRedpaper").on("touchmove",function(){Ta=!1}),$(".btn-redpaper").on("touchend",function(){if(0==Ta)return Ta=!0,!1;var e=parseInt(100*$(".paper-amount").val()),t=$(".paper-number").val(),n=$("#bless-text").val();if(!e||!t)return $("#alert-custom").show(),$("#getSuccess").text(i18nText.notEmpty),!1;n||(n=i18nText.blessWord),$("#redpack-amount").val(e);var a=function(e){"success"==e.status?($(".paper-amount").val(""),$(".paper-number").val(""),$("#bless-text").val(""),$(".money-text").text("0.00"),$(".redpaper-wrap").hide(),X5Full(),$(".chatipt").attr("disabled",!1),$("#moreicon").trigger("touchend"),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",function(){Se(e.data)},!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",function(){Se(e.data)}),document.attachEvent("onWeixinJSBridgeReady",function(){Se(e.data)})):Se(e.data)):"authorization"==e.message?pn?window.open(e.data):window.location.href=e.data:"amount_too_low"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpSumMoreThan1)):"average_amount_too_low"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpSumMoreThanPer1)):"greeting_too_long"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.blessWordTooLong)):"unsupported_redpack_type"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpTypeNotSupported)):($("#alert-custom").show(),$("#getSuccess").text("message: "+e.message))},i=function(){$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpInputTextErr),$(".polyv-form-control").val("")};return $.get(xt+"/front/checkBadWord",{word:n},function(e){e.data&&e.data.result?$.post("/watch/redpack-wxpay",$(".redpaper-wrap form").serialize(),a,"json").fail(i):$(".redpaper-bless-input-group").addClass("redpaper-bless-input-group-err")}).fail(i),!1}),$("#bless-text").on("input",function(){$(".redpaper-bless-input-group").removeClass("redpaper-bless-input-group-err")});var ya,$a,ba,Ta=!0,ka=!1,xa=$("#yiLi-total-amount").length;ka=!!xa,$("body").on("touchmove",".redpaper-msg",function(){Ta=!1}),$("body").on("touchend",".redpaper-msg",function(){if(0==Ta)return Ta=!0,!1;var e=$(this),t=e.parents("li.msg"),n=t.children(".talk-logo").children("img").attr("src"),a=t.find(".talk-name").text(),i=t.find(".redpaper-text").text(),o=e.attr("cid"),s=e.attr("rid"),d="/watch/redpack/"+channelId+"/receive/cache";ba=e.attr("number"),ya=e.data("openid"),$a=e.data("unick"),$(".get-redpaper-hosts-pic>img").attr("src",n),$(".userPic").attr("src",n),$(".give-redpaper-hosts-name").text(a),$(".redpaper-text-full").text(i),$(".bless-content").text(i),$("#open-redpaper").attr("cid",o),$("#open-redpaper").attr("rid",s),$.post(d,{redpackId:s,redCacheId:o},function(e){if("success"==e.status)"success"==e.data?($("#get-redpaper-wrap").fadeIn(),X5Full(!0),$(".no-redpaper-text").text(i18nText.rpGetOver)):_e();else if("expired"==e.message)$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetExpired);else if("none_redpack"==e.message){var t="/weixin-withdraw/"+channelId+"/user";$.post(t,function(e){if("success"==e.status){var t=e.data.balance;t<=1?$("#total-mount,#no-total-mount").hide():($("#all-mount,#no-all-mount").text(t),$("#total-mount,#no-total-mount").show())}},"json"),$("#get-redpaper-wrap").hide(),$("#no-redpaper-wrap").fadeIn()}else"blank_redpackId"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetFailed)):"blank_redCacheId"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetFailed)):"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):($("#alert-custom").show(),$("#getSuccess").text("errorMessage!"))},"json").fail(function(){})});var Ia=!1;$("#open-redpaper").on("touchend",function(){var e=$(this),t=e.attr("rid"),n=e.attr("cid"),a="/watch/redpack/"+channelId+"/receive";$.post(a,{redpackId:t,redCacheId:n},function(e){if("success"==e.status){Ia=!0;var t=e.data.openId;$("#get-redpaper-wrap").hide(),X5Full(),_e();var n=JSON.stringify({EVENT:"GET_REDPAPER",roomId:channelId,openId:ya,getOpenId:t,senderNick:$a,nickname:Et});socket&&socket.emit("message",n)}else if("blank_redpackId"==e.message)$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetFailed);else if("blank_redCacheId"==e.message)$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetFailed);else if("blank_openid"==e.message)$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat);else if("none_redpack"==e.message){var a="/weixin-withdraw/"+channelId+"/user";$.post(a,function(e){if("success"==e.status){var t=e.data.balance;t<=1?$("#total-mount,#no-total-mount").hide():($("#all-mount,#no-all-mount").text(t),$("#total-mount,#no-total-mount").show())}},"json"),$("#get-redpaper-wrap").fadeOut(),$("#no-redpaper-wrap").fadeIn()}else"expired"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetExpired)):"add_sql_fail"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetFailed)):"operation_frequently"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.tryLater)):($("#alert-custom").show(),$("#getSuccess").text("ERROR3: "+e.message))},"json").fail(function(){})}),$("#check-other-redpaper").on("touchend",function(){if(0==Ta)return Ta=!0,!1;_e()}),Ee()||$("#give-redpaper, #get-cash").remove();var Sa={default:{MAX_AMOUNT:300,MAX_NUMBER:50},"21695dc554":{MAX_AMOUNT:5e3,MAX_NUMBER:200},"1c6dc3c666":{MAX_AMOUNT:3e3,MAX_NUMBER:3e3},bd307b246e:{MAX_AMOUNT:1e4,MAX_NUMBER:3e3},"8e15606eab":{MAX_AMOUNT:1e3,MAX_NUMBER:100},"10688df483":{MAX_AMOUNT:1e3,MAX_NUMBER:100},"6f089e7495":{MAX_AMOUNT:1e4,MAX_NUMBER:1e3}},Ca=Sa[accountId]?Sa[accountId].MAX_AMOUNT:Sa.default.MAX_AMOUNT,_a=Sa[accountId]?Sa[accountId].MAX_NUMBER:Sa.default.MAX_NUMBER
;$("#total-amount").keyup(function(){var e=$("#total-amount"),t=e.val();if(""!=t&&(t<1||t>Ca))return $("#alert-custom").show(),$("#getSuccess").text(i18nText.rpSumBetweenMinMax.replace("max",Ca)),e.val(""),$(".money-text").text(""),e.focus(),!1}),$("#number").keyup(function(){var e=$("#number"),t=e.val();if(""!=t&&(t<1||t>_a))return $("#alert-custom").show(),$("#getSuccess").text(i18nText.rpNumberLessThan.replace("max",_a)),e.val(""),e.focus(),!1}),$("#yiLi-total-amount").keyup(function(){var e=$("#yiLi-total-amount"),t=/^\d+(\.\d{0,2})?$/;if(e.val().constructor===String){if(null==e.val().match(t)&&""!=e.val())return $("#alert-custom").show(),$("#getSuccess").text(i18nText.rpSumTip1),e.val(""),$(".money-text").text(""),e.focus(),!1}}),$("#cashLimit").keyup(function(){var e=$("#cashLimit"),t=/^\d+(\.\d{0,2})?$/;if(e.val().constructor===String){if(null==e.val().match(t)&&""!=e.val())return $("#alert-custom").show(),$("#getSuccess").text(i18nText.rpSumTip1),e.val(""),e.focus(),!1}}),$(function(){$("#number").keyup(Oe),$("#total-amount").keyup(Oe),$("#total-amount").mouseup(function(e){e.preventDefault()})}),$("#getCash").on("touchend",function(){if(0==Ta)return Ta=!0,!1;if($(".user-name").attr("disabled",!0),0==Ee())return $("#alert-custom").show(),void $("#getSuccess").text(i18nText.rpGetCashInWeChat);$(".my-cash-wrap").fadeIn(),X5Full(!0),$(".chatipt").attr("disabled",!0),$(".cash-input").focus(function(){$(".submit-cash").hide()});var e="/weixin-withdraw/"+channelId+"/user";$.post(e,function(e){if("success"==e.status)$(".user-name").val(e.data.nickname);else if("blank_openid"==e.message)$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat);else{if("user_not_found"!=e.message)return $("#alert-custom").show(),$("#getSuccess").text(i18nText.loadFailed),!1;$("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetNoUser)}},"json")}),$("#yes").on("touchend",function(){if(0==Ta)return Ta=!0,!1;var e="/weixin-withdraw/"+channelId+"/withdraw-amount",t=100*$("#cashLimit").val(),n=parseInt(t);$.post(e,{amount:n},function(e){"success"===e.status?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetCashSuccess),$("#cashLimit").val("")):"user_not_found"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetNoUser)):"amount_over_limit"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetCashExceed)):"invalid_amount"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetCashMoreThan1)):"set_data_fail"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpGetCashFailed)):"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):($("#alert-custom").show(),$("#getSuccess").text("ERROR5: "+e.message))},"json").fail(function(){})}),$("#cancel").on("touchend",function(){if(0==Ta)return Ta=!0,!1;$(".my-cash-wrap").fadeOut(),$(".chatipt").attr("disabled",!1)}),$("#get-cash,#no-total-mount").on("touchend",function(){if(0==Ta)return Ta=!0,!1;$(".iconback").hide(),$(".redpaper-close").css({"margin-left":"0px"}),Le()}),$("#total").on("touchend",function(){if(0==Ta)return Ta=!0,!1;Le()}),$("#total-mount").on("touchend",function(){if(0==Ta)return Ta=!0,!1;$(".iconback").show(),$(".redpaper-close").css({"margin-left":"35px"}),Le()});var Ea=1,Oa=!0,La=0;$("#historyGetCash").on("touchend",function(){if(0==Ta)return Ta=!0,!1;La=!0,Oa=!0,Ea=1,$(".Cash").css({"border-bottom":"3px solid #2196f3"}),$(".Redpaper").css({"border-bottom":"none"});var e="/weixin-withdraw/"+channelId+"/withdraw/page";$.post(e,function(e){if("success"==e.status){$(".statistics li").remove();for(var t=0;t<e.data.contents.length;t++){var n=Ce(e.data.contents[t].amount);$(".statistics").append('<li class="li-cash"><p class="p-cash"><span class="left">'+i18nText.rpGetCash+'</span><span class="price currPaper">- ¥ '+n+'</span><br/><span class="left time-paper">'+Ne(e.data.contents[t].paidTime)+'</span></p><img src="//livestatic.videocc.net/assets/wimages/get-cash.png" alt=""></li>')}return e.data.lastPage?Oa=!1:Ea++}"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):($("#alert-custom").show(),$("#getSuccess").text("ERROR9: "+e.message))},"json").fail(function(){})});var Na=1,Ma=!0;$("#historyGetRedpaper").on("touchend",function(){if(0==Ta)return Ta=!0,!1;$(".Redpaper").css({"border-bottom":"3px solid #2196f3"}),$(".Cash").css({"border-bottom":"none"});var e="/watch/redpack/"+channelId+"/receive/page";La=!1,Ma=!0,Na=1,$.post(e,function(e){if("success"==e.status){$(".statistics li").remove();for(var t=0;t<e.data.contents.length;t++){var n=Ce(e.data.contents[t].amount);$(".statistics").append('<li class="li-cash"><p class="p-cash"><span class="left">'+i18nText.rpGet+'</span><span class="price withdraw">+ ¥ '+n+'</span><br/><span class="left time-paper">'+Ne(e.data.contents[t].createdTime)+'</span></p><img src="//livestatic.videocc.net/assets/wimages/redpaper.png" alt=""></li>')}return e.data.lastPage?Ma=!1:Na++}"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):($("#alert-custom").show(),$("#getSuccess").text("ERROR8: "+e.message))},"json").fail(function(){})}),$(".redpaper-Detail-body").scroll(function(){var e=$(this).height(),t=$(this).get(0).scrollHeight,n=$(this).scrollTop(),a=t-e;if(n==a&&!0===Oa&&!0===La){var i="/weixin-withdraw/"+channelId+"/withdraw/page";$.post(i,{page:Ea},function(e){if("success"==e.status){for(var t=0;t<e.data.contents.length;t++){var n=Ce(e.data.contents[t].amount);$(".statistics").append('<li class="li-cash"><p class="p-cash"><span class="left">'+i18nText.rpGetCash+'</span><span class="price currPaper">- ¥ '+n+'</span><br/><span class="left time-paper">'+Ne(e.data.contents[t].paidTime)+'</span></p><img src="//livestatic.videocc.net/assets/wimages/get-cash.png" alt=""></li>')}if(e.data.lastPage)return Oa=!1;Ea++}else"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):($("#alert-custom").show(),$("#getSuccess").text("ERROR9: "+e.message))},"json").fail(function(){})}else if(n==a&&!0===Ma&&!1===La){var i="/watch/redpack/"+channelId+"/receive/page";$.post(i,{page:Na},function(e){if("success"==e.status){for(var t=0;t<e.data.contents.length;t++){var n=Ce(e.data.contents[t].amount);$(".statistics").append('<li class="li-cash"><p class="p-cash"><span class="left">'+i18nText.rpGet+'</span><span class="price withdraw">+ ¥ '+n+'</span><br/><span class="left time-paper">'+Ne(e.data.contents[t].createdTime)+'</span></p><img src="//livestatic.videocc.net/assets/wimages/redpaper.png" alt=""></li>')}if(e.data.lastPage)return Ma=!1;Na++}else"blank_openid"==e.message?($("#alert-custom").show(),$("#getSuccess").text(i18nText.rpOpenWidthWeChat)):($("#alert-custom").show(),$("#getSuccess").text("ERROR8: "+e.message))},"json").fail(function(){})}}),$("#chatipt, #chatipt_aq").on("focus",function(){Dt||cn||(Me(),$(this).trigger("blur"))}),$(".question_btn>span").on("click",function(){cn||Dt||(Me(),$("#chatipt_aq").trigger("blur"))});var Aa=$("#diy-nick-name");Aa.on("keypress",function(e){var t=e.keyCode||e.which;if(!cn&&13===t)return Je.trigger("click"),!1});var ja=null;Je.on(mt,function(){Re(this,"#diy-nick-name")}),$("#cancel-setnick").on("click",function(){Aa.val(""),$("#set-nick-modal,.mask").hide()}),$(".js-talk-input-cover").on(mt,function(){$(this).addClass("active-set-name").children(".set-name-wrap").show()}),$(".js-ensure-name").on(mt,function(){Re(this,$(this).prev(".js-set-name-input"))}),$("#showAnnouncement").on(mt,function(){return qe(),!1}),$("#announcementWrap").on("click",function(e){if("close"===$(e.target).data("type"))return qe(!1),!1});var Ra=0;setInterval(function(){if(Jt.length&&A(Jt.shift()),Yt.length&&v(Yt.shift()),tn.length&&u(tn.shift()),en.length&&c(en.shift()),Xt.length&&l(Xt.splice(0,20)),Zt.length){Ra=0;var e=Zt.length;Zt.length>10?p(Zt.splice(0),e):p(Zt.shift(),1)}else 30==++Ra&&(it.hide(),ot.hide());Kt.length?m(Kt.shift()):30==++Tn&&$(".like-msg").hide()},200),window.x5Full=function(){if(!useVr){var e=$("body").hasClass("stream-scale-4-3"),t=$("body").width()*(e?.75:.5625),n=t+50;$("body").addClass("x5-full"),$(".main-section-wrap-container").css({top:n}),ae()}setTimeout(function(){window.initClientHeight=window.innerHeight},10)},window.x5Exit=function(){if(!useVr){var e=$("body").hasClass("stream-scale-4-3");$("body").width();$("body").removeClass("x5-full player-system-full-screen"),$(".main-section-wrap-container").css({top:0}),$("video")[0].style.objectPosition="50% 0px"}setTimeout(function(){window.initClientHeight=window.innerHeight},10)},window.fullPage=function(){$("body").addClass("player-system-full-screen")},window.normalPage=function(){$("body").removeClass("player-system-full-screen"),setTimeout(function(){window.x5Full()},300)};var qa=null,Pa=null;$("#sendImgForChat").length>0&&(Pa=new UpLoadingImgForChat("#sendImgForChat",{channelId:channelId,lang:language}));var Wa="",Ha="//livestatic.videocc.net/assets/wimages/pc_images/loading.gif";Pa&&Pa.subscript(function(e){Wa=e.id;var t=e.status,n=e.msg;if("upLoadingSuccess"!==t&&We(n),"fail"!==t)return"upLoadingFail"===t||"forbid"===t||"success"===t&&document.querySelector("#"+e.id)?void He(e):void De(e)}),$("body").on(mt,".chatImgFailIcon",function(e){var t=e.target,n=$(t).parents(".talk-txt"),a=n.find("img"),i=n.find("img").attr("id");a.attr("src",Ha),n.removeClass("uploading-fail"),Pa.addNewImg(i)});var Da=cn?"change":"click",Fa=$("#language-select-list");$("#language-select").on(Da,function(){cn?location.href=location.origin+location.pathname+"?lang="+$(this).val():Fa.toggle()}),Fa.on("click","li",function(){location.href=location.origin+location.pathname+"?lang="+$(this).data("value")}),function(){if(hasQA){var e=1,t=1,n=!0,a=!0,i=function(e,t){var n="问：",a="提问 ",i=t.actor||"";"A"===e&&(n="答："),"MA"===e&&(n="追加："),"Q"!==e&&(a="回复 "),i+=t.nick;var o=t.time;o=(new Date).toLocaleDateString()===new Date(o).toLocaleDateString()?o.substring(11):o.substring(0,16);var s=t.userId===Ct?'<span class="plv-watch-qa-about-me">@我</span>':"";return'<div class="plv-watch-qa-item"><p class="plv-watch-qa-item-content">'+n+t.content+'</p><p class="plv-watch-qa-item-info"><span>'+i+"</span><span>"+a+o+"</span>"+s+"</p></div>"},o=function(e){var t=[];return e.forEach(function(e){var n=e.viewerId===Ct,a=i("Q",{content:e.askContent,nick:e.viewerName,time:e.createdTime,userId:e.viewerId}),o=[];e.replyContents.forEach(function(e,t){o.push(i(0===t?"A":"MA",{content:e.replyContent,nick:e.replierName,actor:e.replierActor,time:e.createdTime}))});var s="plv-watch-qa-other-question-li";n&&(s=""),o.length>1&&(s+=" plv-watch-qa-other-question-li-multiple-reply");var d=o.join("");t.push('<li class="'+s+'"><div class="plv-watch-qa-question">'+a+'</div><div class="plv-watch-qa-replys">'+d+"</div></li>")}),t},s=function(e){n=!1,$.ajax({url:"/watch/"+channelId+"/get-consultation-list",data:{channelId:channelId,sessionId:currentSessionId,page:e}}).success(function(e){200===e.code&&e.data&&($("#plvWatchQaList").append(o(e.data.contents).join("")),a&&($("#QANumer").html(e.data.totalCount),a=!1,t=e.data.totalPages))}).always(function(){n=!0})};$(cn?'.tab-nav-ctrl li[data-type="QA"]':'[data-target="#plv-watch-QA-panel"]').on(mt,function(){a&&s(e)}),$(".plv-watch-qa-middle").scroll(function(){var a=$(this);n&&e<t&&a.scrollTop()+a.height()+30>=a[0].scrollHeight&&s(++e)}),$(".plv-watch-qa-top-right>p").on(mt,function(){return $(".plv-watch-qa-top-right").toggleClass("show-category-selection"),!1}),$("#plvWatchQaTypeSelect").on(mt,"li",function(){var e=$(this).data("type");$(".plv-watch-qa-current-type").removeClass("plv-watch-qa-current-type"),$(this).addClass("plv-watch-qa-current-type"),"aboutMe"===e?$("#plvWatchQaList").addClass("plv-watch-qa-only-about-me"):$("#plvWatchQaList").removeClass("plv-watch-qa-only-about-me"),$("#plvWatchQaType").text($(this).html())})}}()}),window.formatTalkTime=function(e,t){var n,a=(new Date).toLocaleDateString(),i=new Date(t),o=i.toLocaleDateString(),s="";return e=new Date(e),a!=o&&(s=o+" "),s+=formatTime(i.getHours())+":"+formatTime(i.getMinutes()),Math.abs(t-e)>12e4&&(n=$('<li class="sys-info msg-time" data-time="'+this.time+'">'+s+"</li>")),n},window.loadImage=function(e,t){var n=new Image;if(n.src=e,n.complete)return void t.call(n);n.onload=function(){t.call(n)}},Translator.prototype.removeImg=function(e){return e.indexOf("<")<0?e:e.replace(/<img\b[^>]*>/gi,"")},Translator.prototype.needTranslate=function(e){return e=this.removeImg(e),!!/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi.test(e)||e.search(/[a-zA-Z]+/)>=0},Translator.prototype.translate=function(e,t){return $.ajax({url:e,type:"post",data:{query:t}})},Translator.prototype.showError=function(e){e=e||3e3,this.timer&&clearTimeout(this.timer),this.errTip.show();var t=this;this.timer=setTimeout(function(){t.errTip.hide()},e)},$(document).ready(function(){$.fn.onlyNum=function(){var e=!0;$("body").on("click",function(t){var n=window.navigator.userAgent;-1!=n.indexOf("MSIE")||n.indexOf("Trident")>-1?$(t.target).hasClass("onlyNum")?e=!0:(e=!1,$(".onlyNum").blur()):e=!1}),$(this).keydown(function(e){var t=window.event||e,n=t.keyCode||t.which;return 190==n||8==n||110==n||n>=48&&n<=57||n>=96&&n<=105}).focus(function(e){}).blur(function(){e&&this.focus()}).bind("paste",function(){return!!/^\d+$/.test(window.clipboardData.getData("Text"))})},$(".onlyNum").onlyNum()}),$(document).ready(function(){"countTime"in window&&""!=countTime&&(countTime=countTime&&countTime.replace(/-/g,"/"),countTime=function(e){var t=new Date(e),n=t.getTime(),a=t.getTimezoneOffset(),i=-480-a,o=n+60*i*1e3;return new Date(o)}(countTime),countTime=countTime.getTime()/1e3,setInterval(function(){var e=Math.round(new Date/1e3),t=countTime-e,n=parseInt(t/3600),a=parseInt(n/24),i=parseInt(n-24*a),o=parseInt((t-3600*n)/60),s=parseInt(t-3600*n-60*o);1==countOpen&&"end"==livestatus&&t>0?($(".player-days").text(timeReturn(a)),$(".player-hours").text(timeReturn(i)),$(".player-minutes").text(timeReturn(o)),$(".player-seconds").text(timeReturn(s)),1==videoOpen?($("#player-countdown").css({display:"none"}),$("#live-int-countdown,#fl-countdown").css({display:"block"})):0==videoOpen&&($("#player-countdown").css({display:"block"}),$("#live-int-countdown").css({display:"none"}))):$("#live-int-countdown,#player-countdown,#fl-countdown").css({display:"none"})},500))});var tmp={showBigImage:function(e){return'<div id="tuwenShowBigImage" class="plv-tuwen-live__image__preview"><button class="plv-tuwen-live__close" data-type="tuwen-close"></button><img src="'+e+'"><button data-type="tuwen-pre" class="plv-tuwen-live__left"></button><button data-type="tuwen-next" class="plv-tuwen-live__right"></button></div>'},tipsShow:function(e){return'<span class="plv-tuwen-live__tips__warning">'+e+'<span class="plv-tuwen-live__tips__close">×</span></span>'},mobPreviewImg:function(e,t){function n(e,t){return $('<div class="img-previewer-item" style="left: '.concat(100*t,'%;"><div class="img-previewer-item__inner"><img class="img-previewer__img" src="').concat(e,'" /></div></div>'))}var a=t.length;if(e>a-1)throw Error("index超过数组的最大长度");if(0===a)throw Error("image array cannot be empty");for(var i=window.screen.width,o=$('<div class="img-previewer"></div>'),s=$('<div class="img-previewer__index">'.concat(e+1,"/").concat(a,"</div>")),d=a<=1?0:1,r=$('<div class="img-previewer__wrap" style="transform: translate3d('.concat(-d*i,'px, 0, 0)"></div>')),u=function(e,t){var n=[];return 1===t.length?t:(n.push(t[0===e?a-1:e-1]),n.push(t[e]),n.push(t[e===a-1?0:e+1]),n)}(e,t),c=0;c<u.length;c++){var l=n(u[c],c);r.append(l)}if(o.append(s),o.append(r),$("body").append(o),$("html").addClass("noscroll"),o.on("click",function(){$("html").removeClass("noscroll"),o.remove()}),1!==a){var p=0,f=0,h=0,m=0;r.on("touchstart",function(e){p=e.originalEvent.touches[0].pageX&e.originalEvent.changedTouches[0].pageX&e.originalEvent.targetTouches[0].pageX,h=e.originalEvent.touches[0].pageY&e.originalEvent.changedTouches[0].pageY&e.originalEvent.targetTouches[0].pageY,f=p,m=h,r.css("transition","none")}).on("touchmove",function(e){f=e.originalEvent.touches[0].pageX&e.originalEvent.changedTouches[0].pageX&e.originalEvent.targetTouches[0].pageX,m=e.originalEvent.touches[0].pageY&e.originalEvent.changedTouches[0].pageY&e.originalEvent.targetTouches[0].pageY;var t=f-p;Math.abs(m-h)>50||Math.abs(t)>20&&(t=.75*t-d*i,r.css("transform","translate3d("+t+"px, 0, 0)"),e.preventDefault())}).on("touchend",function(){var o=f-p;if(Math.abs(o)>40){if(o<0){e=e+1<a?e+1:0,d+=1,$(".img-previewer-item").first().remove();var u=t[e+1>=a?0:e+1],c=n(u,d+1);r.append(c)}if(o>0){e=e-1>=0?e-1:a-1,d-=1,$(".img-previewer-item").last().remove();var l=t[e-1>=0?e-1:a-1],h=n(l,d-1);r.prepend(h)}}r.css({transform:"translate3d("+-d*i+"px, 0, 0)",transition:"0.25s"}),s.html(e+1+"/"+a)})}}};$(document).ready(function(){function e(){var e=$("#tuwenShowBigImage");e.on("click","[data-type]",function(){var n=$(this).attr("data-type"),a=0;switch(n){case"tuwen-close":e.remove();break;case"tuwen-pre":if((u-=1)<0){s(i18nText.tuwenFirstImage),u=0;break}a=u<=0?0:u,u=a,t(r[a]);break;case"tuwen-next":if((u+=1)>r.length-1){s(i18nText.tuwenLastImage),u=r.length-1;break}a=u>=r.length-1?r.length-1:u,u=a,t(r[a])}})}function t(t){var n=$("#tuwenShowBigImage");n.length>0&&n.remove();var a=tmp.showBigImage(t);m.append(a),e()}function n(){p||(p=!0,window.plvTuwenLive=new PlvTuwenLive({container:document.getElementById("plvTuwenWrap"),$:$,channelId:channelId,dispMode:c,isEditMode:!1,lang:"en"===language?"en":"zh-cn",apiURL:"/watch/"+channelId+"/tuwen/content/list",events:{imgclick:function(e){if(d)return void tmp.mobPreviewImg(e.currentIndex,e.imgs);r=e.imgs,u=e.currentIndex,t(r[u])},newmsg:function(){0!==l&&1===c&&g.find(".plv-tuwen-live__more__content").addClass("plv-tuwen-live__icon__show"),0===l&&1===c&&plvTuwenLive.scrollToLatest()},totalchange:function(e){y.text(e.total),d&&o()}}}))}function a(e){$('.js-polyv-page-footer[data-target="tuwen"]').length||$(e).append(h)}function i(e){$('.js-polyv-page-footer[data-target="tuwen"]').remove(),e&&a(e)}function o(){var e=$("#plvTuwenWrap").height(),t=$(".plv-tuwen-live__end").height()+20+36,n=setInterval(function(){var a=$(".plv-tuwen-live__list").height();a&&(clearInterval(n),n=null,e-t<a?0!==f&&1!==f||(f=2,i()):0===f?f=1:(f=1,i(".plv-tuwen-live__main_content"),$('.js-polyv-page-footer[data-target="tuwen"]').addClass("polyv-page-footer-abs")))},50)}function s(e,t){t=t||2;var n=$("#tuwenShowBigImage"),a=$(tmp.tipsShow(e));n.find(".plv-tuwen-live__tips__warning").remove(),n.append(a),setTimeout(function(){n.find(".plv-tuwen-live__tips__warning").remove()},1e3*t),a.find(".plv-tuwen-live__tips__close").on("click",function(){n.find(".plv-tuwen-live__tips__warning").remove()})}if(!window.hasFrame){var d=function(){var e=navigator.userAgent||navigator.vendor||window.opera,t=!1;return(/(android|bb\d+|meego).+mobile|ios|IOS|iOS|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|Pad|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}(),r=[],u=0,c=1,l=0,p=!1,f=0,h=$('.js-polyv-page-footer[data-target="tuwen"]'),m=$("body"),v=$("#plvTuwenWrap"),g=$("#plvTuwenLiveBar"),w=$("#plvTuwenLiveBackTop"),y=$("#plvTuwenLiveTotalMessage"),b=$(d?".tab-nav-ctrl>li":".bbox-tab-nav>li"),T=$(".bbox-tab-nav"),k=$(".bbox>.box-content"),x="tuwen"===b.eq(0).attr("data-type");if(!d){var I=$(window).height(),S=g.outerHeight(),C=T.outerHeight(),_=parseInt(k.css("padding-bottom").replace("px",""),10),E=S+C+_,O=I-E+"px";v.css("max-height",O)}v.length>0&&(document.getElementById("plvTuwenWrap").onscroll=function(){l=v.scrollTop(),0!==l?(w.removeClass("plv-tuwen-live__icon__hide"),w.addClass("plv-tuwen-live__icon__show")):(w.removeClass("plv-tuwen-live__icon__show"),w.addClass("plv-tuwen-live__icon__hide"),g.find(".plv-tuwen-live__more__content").removeClass("plv-tuwen-live__icon__show")),d&&2===f&&$(".plv-tuwen-live__list")[0].scrollHeight-v.height()-l<10&&(a("#plvTuwenWrap"),$('.js-polyv-page-footer[data-target="tuwen"]').removeClass("polyv-page-footer-abs"))}),window.tuwenReconnect=function(){console.log("RECONNECT"),plvTuwenLive.destroy(),p=!1,n()},x&&v.length>0&&n(),g.on("click","[data-type]",function(){switch($(this).attr("data-type")){case"tuwen-more":plvTuwenLive.scrollToLatest(),g.find(".plv-tuwen-live__more__content").removeClass("plv-tuwen-live__icon__show");break;case"mode-tuwen":if(d&&1===c)return $(this).removeClass("plv-tuwen-live-mode-active").siblings("button").addClass("plv-tuwen-live-mode-active"),c=2,void plvTuwenLive.setDispMode(c);2===c&&(g.find("button").removeClass("plv-tuwen-live-mode-active"),$(this).addClass("plv-tuwen-live-mode-active"),plvTuwenLive.setDispMode(1),c=1);break;case"mode-images":if(d&&2===c)return $(this).removeClass("plv-tuwen-live-mode-active").siblings("button").addClass("plv-tuwen-live-mode-active"),c=1,void plvTuwenLive.setDispMode(c);1===c&&(g.find("button").removeClass("plv-tuwen-live-mode-active"),$(this).addClass("plv-tuwen-live-mode-active"),plvTuwenLive.setDispMode(2),c=2)}}),w.on("click",function(){plvTuwenLive.scrollToTop()});var L=d?"touchend":"click";b.on(L,function(){var e=$(this).attr("data-type");e&&"tuwen"===e&&n()})}});var $=window.jQuery,InteractiveSDK=window.PolyvInteractiveSDK;InteractiveApp.prototype={init:function(){$('<div id="interactiveApp"></div>').appendTo($("body")),this.interactiveSDK=new InteractiveSDK({el:"#interactiveApp",socket:this.socket,userInfo:this.userInfo,channelInfo:this.channelInfo,locale:this.locale,mobQaEl:this.options.mobQaEl,qaMobHeight:this.options.qaMobHeight||50,qaMobZIndex:this.qaMobZIndex||1})},updateConfig:function(e){this.interactiveSDK&&this.interactiveSDK.updateConfig(e)}};